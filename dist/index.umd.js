(function(wt){typeof define=="function"&&define.amd?define(wt):wt()})(function(){"use strict";var wt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ca={exports:{}};(function(A,_e){(function(de,ae){A.exports=ae()})(wt,function(){var de=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},ae=function(e,t){for(var u=Object.keys(t),x=0;x<u.length;++x)e[u[x]]=t[u[x]];return e},pe=`
`;function Te(e){return typeof atob!="undefined"?atob(e):"base64:"+e}function Ve(e){var t=new Error("(regl) "+e);throw console.error(t),t}function ve(e,t){e||Ve(t)}function Oe(e){return e?": "+e:""}function _r(e,t,u){e in t||Ve("unknown parameter ("+e+")"+Oe(u)+". possible values: "+Object.keys(t).join())}function We(e,t){de(e)||Ve("invalid parameter type"+Oe(t)+". must be a typed array")}function hr(e,t){switch(t){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e=="undefined";case"symbol":return typeof e=="symbol"}}function ot(e,t,u){hr(e,t)||Ve("invalid parameter type"+Oe(u)+". expected "+t+", got "+typeof e)}function Vr(e,t){e>=0&&(e|0)===e||Ve("invalid parameter type, ("+e+")"+Oe(t)+". must be a nonnegative integer")}function Hr(e,t,u){t.indexOf(e)<0&&Ve("invalid value"+Oe(u)+". must be one of: "+t)}var qe=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ur(e){Object.keys(e).forEach(function(t){qe.indexOf(t)<0&&Ve('invalid regl constructor argument "'+t+'". must be one of '+qe)})}function or(e,t){for(e=e+"";e.length<t;)e=" "+e;return e}function yr(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Rt(e,t){this.number=e,this.line=t,this.errors=[]}function Ct(e,t,u){this.file=e,this.line=t,this.message=u}function Ie(){var e=new Error,t=(e.stack||e).toString(),u=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(u)return u[1];var x=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return x?x[1]:"unknown"}function ft(){var e=new Error,t=(e.stack||e).toString(),u=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(u)return u[1];var x=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return x?x[1]:"unknown"}function zr(e,t){var u=e.split(`
`),x=1,C=0,E={unknown:new yr,0:new yr};E.unknown.name=E[0].name=t||Ie(),E.unknown.lines.push(new Rt(0,""));for(var S=0;S<u.length;++S){var D=u[S],N=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(D);if(N)switch(N[1]){case"line":var U=/(\d+)(\s+\d+)?/.exec(N[2]);U&&(x=U[1]|0,U[2]&&(C=U[2]|0,C in E||(E[C]=new yr)));break;case"define":var V=/SHADER_NAME(_B64)?\s+(.*)$/.exec(N[2]);V&&(E[C].name=V[1]?Te(V[2]):V[2]);break}E[C].lines.push(new Rt(x++,D))}return Object.keys(E).forEach(function(j){var z=E[j];z.lines.forEach(function(P){z.index[P.number]=P})}),E}function Ot(e){var t=[];return e.split(`
`).forEach(function(u){if(!(u.length<5)){var x=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(u);x?t.push(new Ct(x[1]|0,x[2]|0,x[3].trim())):u.length>0&&t.push(new Ct("unknown",0,u))}}),t}function Xo(e,t){t.forEach(function(u){var x=e[u.file];if(x){var C=x.index[u.line];if(C){C.errors.push(u),x.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(u)})}function Yo(e,t,u,x,C){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var E=e.getShaderInfoLog(t),S=x===e.FRAGMENT_SHADER?"fragment":"vertex";Aa(u,"string",S+" shader source must be a string",C);var D=zr(u,C),N=Ot(E);Xo(D,N),Object.keys(D).forEach(function(U){var V=D[U];if(!V.hasErrors)return;var j=[""],z=[""];function P(k,p){j.push(k),z.push(p||"")}P("file number "+U+": "+V.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),V.lines.forEach(function(k){if(k.errors.length>0){P(or(k.number,4)+"|  ","background-color:yellow; font-weight:bold"),P(k.line+pe,"color:red; background-color:yellow; font-weight:bold");var p=0;k.errors.forEach(function(g){var M=g.message,Z=/^\s*'(.*)'\s*:\s*(.*)$/.exec(M);if(Z){var G=Z[1];switch(M=Z[2],G){case"assign":G="=";break}p=Math.max(k.line.indexOf(G,p),0)}else p=0;P(or("| ",6)),P(or("^^^",p+3)+pe,"font-weight:bold"),P(or("| ",6)),P(M+pe,"font-weight:bold")}),P(or("| ",6)+pe)}else P(or(k.number,4)+"|  "),P(k.line+pe,"color:red")}),typeof document!="undefined"&&!window.chrome?(z[0]=j.join("%c"),console.log.apply(console,z)):console.log(j.join(""))}),ve.raise("Error compiling "+S+" shader, "+D[0].name)}}function Wo(e,t,u,x,C){if(!e.getProgramParameter(t,e.LINK_STATUS)){var E=e.getProgramInfoLog(t),S=zr(u,C),D=zr(x,C),N='Error linking program with vertex shader, "'+D[0].name+'", and fragment shader "'+S[0].name+'"';typeof document!="undefined"?console.log("%c"+N+pe+"%c"+E,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(N+pe+E),ve.raise(N)}}function Ea(e){e._commandRef=Ie()}function qo(e,t,u,x){Ea(e);function C(N){return N?x.id(N):0}e._fragId=C(e.static.frag),e._vertId=C(e.static.vert);function E(N,U){Object.keys(U).forEach(function(V){N[x.id(V)]=!0})}var S=e._uniformSet={};E(S,t.static),E(S,t.dynamic);var D=e._attributeSet={};E(D,u.static),E(D,u.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function Bt(e,t){var u=ft();Ve(e+" in command "+(t||Ie())+(u==="unknown"?"":" called from "+u))}function Qo(e,t,u){e||Bt(t,u||Ie())}function Ko(e,t,u,x){e in t||Bt("unknown parameter ("+e+")"+Oe(u)+". possible values: "+Object.keys(t).join(),x||Ie())}function Aa(e,t,u,x){hr(e,t)||Bt("invalid parameter type"+Oe(u)+". expected "+t+", got "+typeof e,x||Ie())}function Zo(e){e()}function Jo(e,t,u){e.texture?Hr(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):Hr(e.renderbuffer._renderbuffer.format,u,"unsupported renderbuffer format for attachment")}var Ft=33071,xa=9728,ef=9984,rf=9985,tf=9986,nf=9987,af=5120,of=5121,ff=5122,sf=5123,uf=5124,cf=5125,Ta=5126,ga=32819,Sa=32820,wa=33635,La=34042,lf=36193,Ze={};Ze[af]=Ze[of]=1,Ze[ff]=Ze[sf]=Ze[lf]=Ze[wa]=Ze[ga]=Ze[Sa]=2,Ze[uf]=Ze[cf]=Ze[Ta]=Ze[La]=4;function Ra(e,t){return e===Sa||e===ga||e===wa?2:e===La?4:Ze[e]*t}function Gt(e){return!(e&e-1)&&!!e}function df(e,t,u){var x,C=t.width,E=t.height,S=t.channels;ve(C>0&&C<=u.maxTextureSize&&E>0&&E<=u.maxTextureSize,"invalid texture shape"),(e.wrapS!==Ft||e.wrapT!==Ft)&&ve(Gt(C)&&Gt(E),"incompatible wrap mode for texture, both width and height must be power of 2"),t.mipmask===1?C!==1&&E!==1&&ve(e.minFilter!==ef&&e.minFilter!==tf&&e.minFilter!==rf&&e.minFilter!==nf,"min filter requires mipmap"):(ve(Gt(C)&&Gt(E),"texture must be a square power of 2 to support mipmapping"),ve(t.mipmask===(C<<1)-1,"missing or incomplete mipmap data")),t.type===Ta&&(u.extensions.indexOf("oes_texture_float_linear")<0&&ve(e.minFilter===xa&&e.magFilter===xa,"filter not supported, must enable oes_texture_float_linear"),ve(!e.genMipmaps,"mipmap generation not supported with float textures"));var D=t.images;for(x=0;x<16;++x)if(D[x]){var N=C>>x,U=E>>x;ve(t.mipmask&1<<x,"missing mipmap data");var V=D[x];if(ve(V.width===N&&V.height===U,"invalid shape for mip images"),ve(V.format===t.format&&V.internalformat===t.internalformat&&V.type===t.type,"incompatible type for mip image"),!V.compressed)if(V.data){var j=Math.ceil(Ra(V.type,S)*N/V.unpackAlignment)*V.unpackAlignment;ve(V.data.byteLength===j*U,"invalid data for image, buffer size is inconsistent with image format")}else V.element||V.copy}else e.genMipmaps||ve((t.mipmask&1<<x)==0,"extra mipmap data");t.compressed&&ve(!e.genMipmaps,"mipmap generation for compressed images not supported")}function mf(e,t,u,x){var C=e.width,E=e.height,S=e.channels;ve(C>0&&C<=x.maxTextureSize&&E>0&&E<=x.maxTextureSize,"invalid texture shape"),ve(C===E,"cube map must be square"),ve(t.wrapS===Ft&&t.wrapT===Ft,"wrap mode not supported by cube map");for(var D=0;D<u.length;++D){var N=u[D];ve(N.width===C&&N.height===E,"inconsistent cube map face shape"),t.genMipmaps&&(ve(!N.compressed,"can not generate mipmap for compressed textures"),ve(N.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var U=N.images,V=0;V<16;++V){var j=U[V];if(j){var z=C>>V,P=E>>V;ve(N.mipmask&1<<V,"missing mipmap data"),ve(j.width===z&&j.height===P,"invalid shape for mip images"),ve(j.format===e.format&&j.internalformat===e.internalformat&&j.type===e.type,"incompatible type for mip image"),j.compressed||(j.data?ve(j.data.byteLength===z*P*Math.max(Ra(j.type,S),j.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):j.element||j.copy)}}}}var n=ae(ve,{optional:Zo,raise:Ve,commandRaise:Bt,command:Qo,parameter:_r,commandParameter:Ko,constructor:ur,type:ot,commandType:Aa,isTypedArray:We,nni:Vr,oneOf:Hr,shaderError:Yo,linkError:Wo,callSite:ft,saveCommandRef:Ea,saveDrawInfo:qo,framebufferFormat:Jo,guessCommand:Ie,texture2D:df,textureCube:mf}),hf=0,pf=0,vf=5,bf=6;function Lr(e,t){this.id=hf++,this.type=e,this.data=t}function Ca(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function st(e){if(e.length===0)return[];var t=e.charAt(0),u=e.charAt(e.length-1);if(e.length>1&&t===u&&(t==='"'||t==="'"))return['"'+Ca(e.substr(1,e.length-2))+'"'];var x=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(x)return st(e.substr(0,x.index)).concat(st(x[1])).concat(st(e.substr(x.index+x[0].length)));var C=e.split(".");if(C.length===1)return['"'+Ca(e)+'"'];for(var E=[],S=0;S<C.length;++S)E=E.concat(st(C[S]));return E}function Oa(e){return"["+st(e).join("][")+"]"}function _f(e,t){return new Lr(e,Oa(t+""))}function yf(e){return typeof e=="function"&&!e._reglType||e instanceof Lr}function Ba(e,t){if(typeof e=="function")return new Lr(pf,e);if(typeof e=="number"||typeof e=="boolean")return new Lr(vf,e);if(Array.isArray(e))return new Lr(bf,e.map(function(u,x){return Ba(u,t+"["+x+"]")}));if(e instanceof Lr)return e;n(!1,"invalid option type in uniform "+t)}var Je={DynamicVariable:Lr,define:_f,isDynamic:yf,unbox:Ba,accessor:Oa},mn={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},Fa=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Ef(){var e={"":0},t=[""];return{id:function(u){var x=e[u];return x||(x=e[u]=t.length,t.push(u),x)},str:function(u){return t[u]}}}function Af(e,t,u){var x=document.createElement("canvas");ae(x.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(x),e===document.body&&(x.style.position="absolute",ae(e.style,{margin:0,padding:0}));function C(){var D=window.innerWidth,N=window.innerHeight;if(e!==document.body){var U=x.getBoundingClientRect();D=U.right-U.left,N=U.bottom-U.top}x.width=u*D,x.height=u*N}var E;e!==document.body&&typeof ResizeObserver=="function"?(E=new ResizeObserver(function(){setTimeout(C)}),E.observe(e)):window.addEventListener("resize",C,!1);function S(){E?E.disconnect():window.removeEventListener("resize",C),e.removeChild(x)}return C(),{canvas:x,onDestroy:S}}function xf(e,t){function u(x){try{return e.getContext(x,t)}catch(C){return null}}return u("webgl")||u("experimental-webgl")||u("webgl-experimental")}function Tf(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function gf(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function Ga(e){return typeof e=="string"?e.split():(n(Array.isArray(e),"invalid extension array"),e)}function Na(e){return typeof e=="string"?(n(typeof document!="undefined","not supported outside of DOM"),document.querySelector(e)):e}function Sf(e){var t=e||{},u,x,C,E,S={},D=[],N=[],U=typeof window=="undefined"?1:window.devicePixelRatio,V=!1,j=function(k){k&&n.raise(k)},z=function(){};if(typeof t=="string"?(n(typeof document!="undefined","selector queries only supported in DOM enviroments"),u=document.querySelector(t),n(u,"invalid query string for element")):typeof t=="object"?Tf(t)?u=t:gf(t)?(E=t,C=E.canvas):(n.constructor(t),"gl"in t?E=t.gl:"canvas"in t?C=Na(t.canvas):"container"in t&&(x=Na(t.container)),"attributes"in t&&(S=t.attributes,n.type(S,"object","invalid context attributes")),"extensions"in t&&(D=Ga(t.extensions)),"optionalExtensions"in t&&(N=Ga(t.optionalExtensions)),"onDone"in t&&(n.type(t.onDone,"function","invalid or missing onDone callback"),j=t.onDone),"profile"in t&&(V=!!t.profile),"pixelRatio"in t&&(U=+t.pixelRatio,n(U>0,"invalid pixel ratio"))):n.raise("invalid arguments to regl"),u&&(u.nodeName.toLowerCase()==="canvas"?C=u:x=u),!E){if(!C){n(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var P=Af(x||document.body,j,U);if(!P)return null;C=P.canvas,z=P.onDestroy}S.premultipliedAlpha===void 0&&(S.premultipliedAlpha=!0),E=xf(C,S)}return E?{gl:E,canvas:C,container:x,extensions:D,optionalExtensions:N,pixelRatio:U,profile:V,onDone:j,onDestroy:z}:(z(),j("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function wf(e,t){var u={};function x(S){n.type(S,"string","extension name must be string");var D=S.toLowerCase(),N;try{N=u[D]=e.getExtension(D)}catch(U){}return!!N}for(var C=0;C<t.extensions.length;++C){var E=t.extensions[C];if(!x(E))return t.onDestroy(),t.onDone('"'+E+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(x),{extensions:u,restore:function(){Object.keys(u).forEach(function(S){if(u[S]&&!x(S))throw new Error("(regl): error restoring extension "+S)})}}}function er(e,t){for(var u=Array(e),x=0;x<e;++x)u[x]=t(x);return u}var Lf=5120,Rf=5121,Cf=5122,Of=5123,Bf=5124,Ff=5125,Gf=5126;function Nf(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Da(e){var t,u;return t=(e>65535)<<4,e>>>=t,u=(e>255)<<3,e>>>=u,t|=u,u=(e>15)<<2,e>>>=u,t|=u,u=(e>3)<<1,e>>>=u,t|=u,t|e>>1}function Pa(){var e=er(8,function(){return[]});function t(E){var S=Nf(E),D=e[Da(S)>>2];return D.length>0?D.pop():new ArrayBuffer(S)}function u(E){e[Da(E.byteLength)>>2].push(E)}function x(E,S){var D=null;switch(E){case Lf:D=new Int8Array(t(S),0,S);break;case Rf:D=new Uint8Array(t(S),0,S);break;case Cf:D=new Int16Array(t(2*S),0,S);break;case Of:D=new Uint16Array(t(2*S),0,S);break;case Bf:D=new Int32Array(t(4*S),0,S);break;case Ff:D=new Uint32Array(t(4*S),0,S);break;case Gf:D=new Float32Array(t(4*S),0,S);break;default:return null}return D.length!==S?D.subarray(0,S):D}function C(E){u(E.buffer)}return{alloc:t,free:u,allocType:x,freeType:C}}var Ne=Pa();Ne.zero=Pa();var Df=3408,Pf=3410,If=3411,Mf=3412,kf=3413,Uf=3414,jf=3415,Vf=33901,Hf=33902,zf=3379,$f=3386,Xf=34921,Yf=36347,Wf=36348,qf=35661,Qf=35660,Kf=34930,Zf=36349,Jf=34076,es=34024,rs=7936,ts=7937,ns=7938,as=35724,is=34047,os=36063,fs=34852,Nt=3553,Ia=34067,ss=34069,us=33984,ut=6408,hn=5126,Ma=5121,pn=36160,cs=36053,ls=36064,ds=16384,ms=function(e,t){var u=1;t.ext_texture_filter_anisotropic&&(u=e.getParameter(is));var x=1,C=1;t.webgl_draw_buffers&&(x=e.getParameter(fs),C=e.getParameter(os));var E=!!t.oes_texture_float;if(E){var S=e.createTexture();e.bindTexture(Nt,S),e.texImage2D(Nt,0,ut,1,1,0,ut,hn,null);var D=e.createFramebuffer();if(e.bindFramebuffer(pn,D),e.framebufferTexture2D(pn,ls,Nt,S,0),e.bindTexture(Nt,null),e.checkFramebufferStatus(pn)!==cs)E=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(ds);var N=Ne.allocType(hn,4);e.readPixels(0,0,1,1,ut,hn,N),e.getError()?E=!1:(e.deleteFramebuffer(D),e.deleteTexture(S),E=N[0]===1),Ne.freeType(N)}}var U=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),V=!0;if(!U){var j=e.createTexture(),z=Ne.allocType(Ma,36);e.activeTexture(us),e.bindTexture(Ia,j),e.texImage2D(ss,0,ut,3,3,0,ut,Ma,z),Ne.freeType(z),e.bindTexture(Ia,null),e.deleteTexture(j),V=!e.getError()}return{colorBits:[e.getParameter(Pf),e.getParameter(If),e.getParameter(Mf),e.getParameter(kf)],depthBits:e.getParameter(Uf),stencilBits:e.getParameter(jf),subpixelBits:e.getParameter(Df),extensions:Object.keys(t).filter(function(P){return!!t[P]}),maxAnisotropic:u,maxDrawbuffers:x,maxColorAttachments:C,pointSizeDims:e.getParameter(Vf),lineWidthDims:e.getParameter(Hf),maxViewportDims:e.getParameter($f),maxCombinedTextureUnits:e.getParameter(qf),maxCubeMapSize:e.getParameter(Jf),maxRenderbufferSize:e.getParameter(es),maxTextureUnits:e.getParameter(Kf),maxTextureSize:e.getParameter(zf),maxAttributes:e.getParameter(Xf),maxVertexUniforms:e.getParameter(Yf),maxVertexTextureUnits:e.getParameter(Qf),maxVaryingVectors:e.getParameter(Wf),maxFragmentUniforms:e.getParameter(Zf),glsl:e.getParameter(as),renderer:e.getParameter(ts),vendor:e.getParameter(rs),version:e.getParameter(ns),readFloat:E,npotTextureCube:V}};function fr(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||de(e.data))}var rr=function(e){return Object.keys(e).map(function(t){return e[t]})},Dt={shape:bs,flatten:vs};function hs(e,t,u){for(var x=0;x<t;++x)u[x]=e[x]}function ps(e,t,u,x){for(var C=0,E=0;E<t;++E)for(var S=e[E],D=0;D<u;++D)x[C++]=S[D]}function ka(e,t,u,x,C,E){for(var S=E,D=0;D<t;++D)for(var N=e[D],U=0;U<u;++U)for(var V=N[U],j=0;j<x;++j)C[S++]=V[j]}function Ua(e,t,u,x,C){for(var E=1,S=u+1;S<t.length;++S)E*=t[S];var D=t[u];if(t.length-u==4){var N=t[u+1],U=t[u+2],V=t[u+3];for(S=0;S<D;++S)ka(e[S],N,U,V,x,C),C+=E}else for(S=0;S<D;++S)Ua(e[S],t,u+1,x,C),C+=E}function vs(e,t,u,x){var C=1;if(t.length)for(var E=0;E<t.length;++E)C*=t[E];else C=0;var S=x||Ne.allocType(u,C);switch(t.length){case 0:break;case 1:hs(e,t[0],S);break;case 2:ps(e,t[0],t[1],S);break;case 3:ka(e,t[0],t[1],t[2],S,0);break;default:Ua(e,t,0,S,0)}return S}function bs(e){for(var t=[],u=e;u.length;u=u[0])t.push(u.length);return t}var vn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},_s=5120,ys=5122,Es=5124,As=5121,xs=5123,Ts=5125,gs=5126,Ss=5126,Rr={int8:_s,int16:ys,int32:Es,uint8:As,uint16:xs,uint32:Ts,float:gs,float32:Ss},ws=35048,Ls=35040,Pt={dynamic:ws,stream:Ls,static:35044},bn=Dt.flatten,ja=Dt.shape,Va=35044,Rs=35040,_n=5121,yn=5126,Er=[];Er[5120]=1,Er[5122]=2,Er[5124]=4,Er[5121]=1,Er[5123]=2,Er[5125]=4,Er[5126]=4;function It(e){return vn[Object.prototype.toString.call(e)]|0}function Ha(e,t){for(var u=0;u<t.length;++u)e[u]=t[u]}function za(e,t,u,x,C,E,S){for(var D=0,N=0;N<u;++N)for(var U=0;U<x;++U)e[D++]=t[C*N+E*U+S]}function Cs(e,t,u,x){var C=0,E={};function S(p){this.id=C++,this.buffer=e.createBuffer(),this.type=p,this.usage=Va,this.byteLength=0,this.dimension=1,this.dtype=_n,this.persistentData=null,u.profile&&(this.stats={size:0})}S.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},S.prototype.destroy=function(){z(this)};var D=[];function N(p,g){var M=D.pop();return M||(M=new S(p)),M.bind(),j(M,g,Rs,0,1,!1),M}function U(p){D.push(p)}function V(p,g,M){p.byteLength=g.byteLength,e.bufferData(p.type,g,M)}function j(p,g,M,Z,G,Q){var W;if(p.usage=M,Array.isArray(g)){if(p.dtype=Z||yn,g.length>0){var oe;if(Array.isArray(g[0])){W=ja(g);for(var O=1,R=1;R<W.length;++R)O*=W[R];p.dimension=O,oe=bn(g,W,p.dtype),V(p,oe,M),Q?p.persistentData=oe:Ne.freeType(oe)}else if(typeof g[0]=="number"){p.dimension=G;var re=Ne.allocType(p.dtype,g.length);Ha(re,g),V(p,re,M),Q?p.persistentData=re:Ne.freeType(re)}else de(g[0])?(p.dimension=g[0].length,p.dtype=Z||It(g[0])||yn,oe=bn(g,[g.length,g[0].length],p.dtype),V(p,oe,M),Q?p.persistentData=oe:Ne.freeType(oe)):n.raise("invalid buffer data")}}else if(de(g))p.dtype=Z||It(g),p.dimension=G,V(p,g,M),Q&&(p.persistentData=new Uint8Array(new Uint8Array(g.buffer)));else if(fr(g)){W=g.shape;var $=g.stride,I=g.offset,X=0,Y=0,me=0,le=0;W.length===1?(X=W[0],Y=1,me=$[0],le=0):W.length===2?(X=W[0],Y=W[1],me=$[0],le=$[1]):n.raise("invalid shape"),p.dtype=Z||It(g.data)||yn,p.dimension=Y;var q=Ne.allocType(p.dtype,X*Y);za(q,g.data,X,Y,me,le,I),V(p,q,M),Q?p.persistentData=q:Ne.freeType(q)}else g instanceof ArrayBuffer?(p.dtype=_n,p.dimension=G,V(p,g,M),Q&&(p.persistentData=new Uint8Array(new Uint8Array(g)))):n.raise("invalid buffer data")}function z(p){t.bufferCount--,x(p);var g=p.buffer;n(g,"buffer must not be deleted already"),e.deleteBuffer(g),p.buffer=null,delete E[p.id]}function P(p,g,M,Z){t.bufferCount++;var G=new S(g);E[G.id]=G;function Q(O){var R=Va,re=null,$=0,I=0,X=1;return Array.isArray(O)||de(O)||fr(O)||O instanceof ArrayBuffer?re=O:typeof O=="number"?$=O|0:O&&(n.type(O,"object","buffer arguments must be an object, a number or an array"),"data"in O&&(n(re===null||Array.isArray(re)||de(re)||fr(re),"invalid data for buffer"),re=O.data),"usage"in O&&(n.parameter(O.usage,Pt,"invalid buffer usage"),R=Pt[O.usage]),"type"in O&&(n.parameter(O.type,Rr,"invalid buffer type"),I=Rr[O.type]),"dimension"in O&&(n.type(O.dimension,"number","invalid dimension"),X=O.dimension|0),"length"in O&&(n.nni($,"buffer length must be a nonnegative integer"),$=O.length|0)),G.bind(),re?j(G,re,R,I,X,Z):($&&e.bufferData(G.type,$,R),G.dtype=I||_n,G.usage=R,G.dimension=X,G.byteLength=$),u.profile&&(G.stats.size=G.byteLength*Er[G.dtype]),Q}function W(O,R){n(R+O.byteLength<=G.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+O.byteLength+" starting from offset "+R+" to a buffer of size "+G.byteLength),e.bufferSubData(G.type,R,O)}function oe(O,R){var re=(R||0)|0,$;if(G.bind(),de(O)||O instanceof ArrayBuffer)W(O,re);else if(Array.isArray(O)){if(O.length>0)if(typeof O[0]=="number"){var I=Ne.allocType(G.dtype,O.length);Ha(I,O),W(I,re),Ne.freeType(I)}else if(Array.isArray(O[0])||de(O[0])){$=ja(O);var X=bn(O,$,G.dtype);W(X,re),Ne.freeType(X)}else n.raise("invalid buffer data")}else if(fr(O)){$=O.shape;var Y=O.stride,me=0,le=0,q=0,K=0;$.length===1?(me=$[0],le=1,q=Y[0],K=0):$.length===2?(me=$[0],le=$[1],q=Y[0],K=Y[1]):n.raise("invalid shape");var se=Array.isArray(O.data)?G.dtype:It(O.data),he=Ne.allocType(se,me*le);za(he,O.data,me,le,q,K,O.offset),W(he,re),Ne.freeType(he)}else n.raise("invalid data for buffer subdata");return Q}return M||Q(p),Q._reglType="buffer",Q._buffer=G,Q.subdata=oe,u.profile&&(Q.stats=G.stats),Q.destroy=function(){z(G)},Q}function k(){rr(E).forEach(function(p){p.buffer=e.createBuffer(),e.bindBuffer(p.type,p.buffer),e.bufferData(p.type,p.persistentData||p.byteLength,p.usage)})}return u.profile&&(t.getTotalBufferSize=function(){var p=0;return Object.keys(E).forEach(function(g){p+=E[g].stats.size}),p}),{create:P,createStream:N,destroyStream:U,clear:function(){rr(E).forEach(z),D.forEach(z)},getBuffer:function(p){return p&&p._buffer instanceof S?p._buffer:null},restore:k,_initBuffer:j}}var Os=0,Bs=0,Fs=1,Gs=1,Ns=4,Ds=4,Ar={points:Os,point:Bs,lines:Fs,line:Gs,triangles:Ns,triangle:Ds,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ps=0,Is=1,ct=4,Ms=5120,$r=5121,$a=5122,Xr=5123,Xa=5124,Cr=5125,En=34963,ks=35040,Us=35044;function js(e,t,u,x){var C={},E=0,S={uint8:$r,uint16:Xr};t.oes_element_index_uint&&(S.uint32=Cr);function D(k){this.id=E++,C[this.id]=this,this.buffer=k,this.primType=ct,this.vertCount=0,this.type=0}D.prototype.bind=function(){this.buffer.bind()};var N=[];function U(k){var p=N.pop();return p||(p=new D(u.create(null,En,!0,!1)._buffer)),j(p,k,ks,-1,-1,0,0),p}function V(k){N.push(k)}function j(k,p,g,M,Z,G,Q){k.buffer.bind();var W;if(p){var oe=Q;!Q&&(!de(p)||fr(p)&&!de(p.data))&&(oe=t.oes_element_index_uint?Cr:Xr),u._initBuffer(k.buffer,p,g,oe,3)}else e.bufferData(En,G,g),k.buffer.dtype=W||$r,k.buffer.usage=g,k.buffer.dimension=3,k.buffer.byteLength=G;if(W=Q,!Q){switch(k.buffer.dtype){case $r:case Ms:W=$r;break;case Xr:case $a:W=Xr;break;case Cr:case Xa:W=Cr;break;default:n.raise("unsupported type for element array")}k.buffer.dtype=W}k.type=W,n(W!==Cr||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var O=Z;O<0&&(O=k.buffer.byteLength,W===Xr?O>>=1:W===Cr&&(O>>=2)),k.vertCount=O;var R=M;if(M<0){R=ct;var re=k.buffer.dimension;re===1&&(R=Ps),re===2&&(R=Is),re===3&&(R=ct)}k.primType=R}function z(k){x.elementsCount--,n(k.buffer!==null,"must not double destroy elements"),delete C[k.id],k.buffer.destroy(),k.buffer=null}function P(k,p){var g=u.create(null,En,!0),M=new D(g._buffer);x.elementsCount++;function Z(G){if(!G)g(),M.primType=ct,M.vertCount=0,M.type=$r;else if(typeof G=="number")g(G),M.primType=ct,M.vertCount=G|0,M.type=$r;else{var Q=null,W=Us,oe=-1,O=-1,R=0,re=0;Array.isArray(G)||de(G)||fr(G)?Q=G:(n.type(G,"object","invalid arguments for elements"),"data"in G&&(Q=G.data,n(Array.isArray(Q)||de(Q)||fr(Q),"invalid data for element buffer")),"usage"in G&&(n.parameter(G.usage,Pt,"invalid element buffer usage"),W=Pt[G.usage]),"primitive"in G&&(n.parameter(G.primitive,Ar,"invalid element buffer primitive"),oe=Ar[G.primitive]),"count"in G&&(n(typeof G.count=="number"&&G.count>=0,"invalid vertex count for elements"),O=G.count|0),"type"in G&&(n.parameter(G.type,S,"invalid buffer type"),re=S[G.type]),"length"in G?R=G.length|0:(R=O,re===Xr||re===$a?R*=2:(re===Cr||re===Xa)&&(R*=4))),j(M,Q,W,oe,O,R,re)}return Z}return Z(k),Z._reglType="elements",Z._elements=M,Z.subdata=function(G,Q){return g.subdata(G,Q),Z},Z.destroy=function(){z(M)},Z}return{create:P,createStream:U,destroyStream:V,getElements:function(k){return typeof k=="function"&&k._elements instanceof D?k._elements:null},clear:function(){rr(C).forEach(z)}}}var Ya=new Float32Array(1),Vs=new Uint32Array(Ya.buffer),Hs=5123;function Wa(e){for(var t=Ne.allocType(Hs,e.length),u=0;u<e.length;++u)if(isNaN(e[u]))t[u]=65535;else if(e[u]===1/0)t[u]=31744;else if(e[u]===-1/0)t[u]=64512;else{Ya[0]=e[u];var x=Vs[0],C=x>>>31<<15,E=(x<<1>>>24)-127,S=x>>13&(1<<10)-1;if(E<-24)t[u]=C;else if(E<-14){var D=-14-E;t[u]=C+(S+(1<<10)>>D)}else E>15?t[u]=C+31744:t[u]=C+(E+15<<10)+S}return t}function Re(e){return Array.isArray(e)||de(e)}var qa=function(e){return!(e&e-1)&&!!e},zs=34467,cr=3553,An=34067,Mt=34069,Or=6408,xn=6406,kt=6407,lt=6409,Ut=6410,Qa=32854,Tn=32855,Ka=36194,$s=32819,Xs=32820,Ys=33635,Ws=34042,gn=6402,jt=34041,Sn=35904,wn=35906,Yr=36193,Ln=33776,Rn=33777,Cn=33778,On=33779,Za=35986,Ja=35987,ei=34798,ri=35840,ti=35841,ni=35842,ai=35843,ii=36196,Wr=5121,Bn=5123,Fn=5125,dt=5126,qs=10242,Qs=10243,Ks=10497,Gn=33071,Zs=33648,Js=10240,eu=10241,Nn=9728,ru=9729,Dn=9984,oi=9985,fi=9986,Pn=9987,tu=33170,Vt=4352,nu=4353,au=4354,iu=34046,ou=3317,fu=37440,su=37441,uu=37443,si=37444,mt=33984,cu=[Dn,fi,oi,Pn],Ht=[0,lt,Ut,kt,Or],nr={};nr[lt]=nr[xn]=nr[gn]=1,nr[jt]=nr[Ut]=2,nr[kt]=nr[Sn]=3,nr[Or]=nr[wn]=4;function qr(e){return"[object "+e+"]"}var ui=qr("HTMLCanvasElement"),ci=qr("OffscreenCanvas"),li=qr("CanvasRenderingContext2D"),di=qr("ImageBitmap"),mi=qr("HTMLImageElement"),hi=qr("HTMLVideoElement"),lu=Object.keys(vn).concat([ui,ci,li,di,mi,hi]),Qr=[];Qr[Wr]=1,Qr[dt]=4,Qr[Yr]=2,Qr[Bn]=2,Qr[Fn]=4;var ze=[];ze[Qa]=2,ze[Tn]=2,ze[Ka]=2,ze[jt]=4,ze[Ln]=.5,ze[Rn]=.5,ze[Cn]=1,ze[On]=1,ze[Za]=.5,ze[Ja]=1,ze[ei]=1,ze[ri]=.5,ze[ti]=.25,ze[ni]=.5,ze[ai]=.25,ze[ii]=.5;function pi(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function vi(e){if(!Array.isArray(e))return!1;var t=e.length;return!(t===0||!Re(e[0]))}function Br(e){return Object.prototype.toString.call(e)}function bi(e){return Br(e)===ui}function _i(e){return Br(e)===ci}function du(e){return Br(e)===li}function mu(e){return Br(e)===di}function hu(e){return Br(e)===mi}function pu(e){return Br(e)===hi}function In(e){if(!e)return!1;var t=Br(e);return lu.indexOf(t)>=0?!0:pi(e)||vi(e)||fr(e)}function yi(e){return vn[Object.prototype.toString.call(e)]|0}function vu(e,t){var u=t.length;switch(e.type){case Wr:case Bn:case Fn:case dt:var x=Ne.allocType(e.type,u);x.set(t),e.data=x;break;case Yr:e.data=Wa(t);break;default:n.raise("unsupported texture type, must specify a typed array")}}function Ei(e,t){return Ne.allocType(e.type===Yr?dt:e.type,t)}function Ai(e,t){e.type===Yr?(e.data=Wa(t),Ne.freeType(t)):e.data=t}function bu(e,t,u,x,C,E){for(var S=e.width,D=e.height,N=e.channels,U=S*D*N,V=Ei(e,U),j=0,z=0;z<D;++z)for(var P=0;P<S;++P)for(var k=0;k<N;++k)V[j++]=t[u*P+x*z+C*k+E];Ai(e,V)}function zt(e,t,u,x,C,E){var S;if(typeof ze[e]!="undefined"?S=ze[e]:S=nr[e]*Qr[t],E&&(S*=6),C){for(var D=0,N=u;N>=1;)D+=S*N*N,N/=2;return D}else return S*u*x}function _u(e,t,u,x,C,E,S){var D={"don't care":Vt,"dont care":Vt,nice:au,fast:nu},N={repeat:Ks,clamp:Gn,mirror:Zs},U={nearest:Nn,linear:ru},V=ae({mipmap:Pn,"nearest mipmap nearest":Dn,"linear mipmap nearest":oi,"nearest mipmap linear":fi,"linear mipmap linear":Pn},U),j={none:0,browser:si},z={uint8:Wr,rgba4:$s,rgb565:Ys,"rgb5 a1":Xs},P={alpha:xn,luminance:lt,"luminance alpha":Ut,rgb:kt,rgba:Or,rgba4:Qa,"rgb5 a1":Tn,rgb565:Ka},k={};t.ext_srgb&&(P.srgb=Sn,P.srgba=wn),t.oes_texture_float&&(z.float32=z.float=dt),t.oes_texture_half_float&&(z.float16=z["half float"]=Yr),t.webgl_depth_texture&&(ae(P,{depth:gn,"depth stencil":jt}),ae(z,{uint16:Bn,uint32:Fn,"depth stencil":Ws})),t.webgl_compressed_texture_s3tc&&ae(k,{"rgb s3tc dxt1":Ln,"rgba s3tc dxt1":Rn,"rgba s3tc dxt3":Cn,"rgba s3tc dxt5":On}),t.webgl_compressed_texture_atc&&ae(k,{"rgb atc":Za,"rgba atc explicit alpha":Ja,"rgba atc interpolated alpha":ei}),t.webgl_compressed_texture_pvrtc&&ae(k,{"rgb pvrtc 4bppv1":ri,"rgb pvrtc 2bppv1":ti,"rgba pvrtc 4bppv1":ni,"rgba pvrtc 2bppv1":ai}),t.webgl_compressed_texture_etc1&&(k["rgb etc1"]=ii);var p=Array.prototype.slice.call(e.getParameter(zs));Object.keys(k).forEach(function(f){var T=k[f];p.indexOf(T)>=0&&(P[f]=T)});var g=Object.keys(P);u.textureFormats=g;var M=[];Object.keys(P).forEach(function(f){var T=P[f];M[T]=f});var Z=[];Object.keys(z).forEach(function(f){var T=z[f];Z[T]=f});var G=[];Object.keys(U).forEach(function(f){var T=U[f];G[T]=f});var Q=[];Object.keys(V).forEach(function(f){var T=V[f];Q[T]=f});var W=[];Object.keys(N).forEach(function(f){var T=N[f];W[T]=f});var oe=g.reduce(function(f,T){var y=P[T];return y===lt||y===xn||y===lt||y===Ut||y===gn||y===jt||t.ext_srgb&&(y===Sn||y===wn)?f[y]=y:y===Tn||T.indexOf("rgba")>=0?f[y]=Or:f[y]=kt,f},{});function O(){this.internalformat=Or,this.format=Or,this.type=Wr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=si,this.width=0,this.height=0,this.channels=0}function R(f,T){f.internalformat=T.internalformat,f.format=T.format,f.type=T.type,f.compressed=T.compressed,f.premultiplyAlpha=T.premultiplyAlpha,f.flipY=T.flipY,f.unpackAlignment=T.unpackAlignment,f.colorSpace=T.colorSpace,f.width=T.width,f.height=T.height,f.channels=T.channels}function re(f,T){if(!(typeof T!="object"||!T)){if("premultiplyAlpha"in T&&(n.type(T.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),f.premultiplyAlpha=T.premultiplyAlpha),"flipY"in T&&(n.type(T.flipY,"boolean","invalid texture flip"),f.flipY=T.flipY),"alignment"in T&&(n.oneOf(T.alignment,[1,2,4,8],"invalid texture unpack alignment"),f.unpackAlignment=T.alignment),"colorSpace"in T&&(n.parameter(T.colorSpace,j,"invalid colorSpace"),f.colorSpace=j[T.colorSpace]),"type"in T){var y=T.type;n(t.oes_texture_float||!(y==="float"||y==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),n(t.oes_texture_half_float||!(y==="half float"||y==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),n(t.webgl_depth_texture||!(y==="uint16"||y==="uint32"||y==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),n.parameter(y,z,"invalid texture type"),f.type=z[y]}var ee=f.width,ye=f.height,a=f.channels,r=!1;"shape"in T?(n(Array.isArray(T.shape)&&T.shape.length>=2,"shape must be an array"),ee=T.shape[0],ye=T.shape[1],T.shape.length===3&&(a=T.shape[2],n(a>0&&a<=4,"invalid number of channels"),r=!0),n(ee>=0&&ee<=u.maxTextureSize,"invalid width"),n(ye>=0&&ye<=u.maxTextureSize,"invalid height")):("radius"in T&&(ee=ye=T.radius,n(ee>=0&&ee<=u.maxTextureSize,"invalid radius")),"width"in T&&(ee=T.width,n(ee>=0&&ee<=u.maxTextureSize,"invalid width")),"height"in T&&(ye=T.height,n(ye>=0&&ye<=u.maxTextureSize,"invalid height")),"channels"in T&&(a=T.channels,n(a>0&&a<=4,"invalid number of channels"),r=!0)),f.width=ee|0,f.height=ye|0,f.channels=a|0;var c=!1;if("format"in T){var h=T.format;n(t.webgl_depth_texture||!(h==="depth"||h==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),n.parameter(h,P,"invalid texture format");var v=f.internalformat=P[h];f.format=oe[v],h in z&&("type"in T||(f.type=z[h])),h in k&&(f.compressed=!0),c=!0}!r&&c?f.channels=nr[f.format]:r&&!c?f.channels!==Ht[f.format]&&(f.format=f.internalformat=Ht[f.channels]):c&&r&&n(f.channels===nr[f.format],"number of channels inconsistent with specified format")}}function $(f){e.pixelStorei(fu,f.flipY),e.pixelStorei(su,f.premultiplyAlpha),e.pixelStorei(uu,f.colorSpace),e.pixelStorei(ou,f.unpackAlignment)}function I(){O.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function X(f,T){var y=null;if(In(T)?y=T:T&&(n.type(T,"object","invalid pixel data type"),re(f,T),"x"in T&&(f.xOffset=T.x|0),"y"in T&&(f.yOffset=T.y|0),In(T.data)&&(y=T.data)),n(!f.compressed||y instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),T.copy){n(!y,"can not specify copy and data field for the same texture");var ee=C.viewportWidth,ye=C.viewportHeight;f.width=f.width||ee-f.xOffset,f.height=f.height||ye-f.yOffset,f.needsCopy=!0,n(f.xOffset>=0&&f.xOffset<ee&&f.yOffset>=0&&f.yOffset<ye&&f.width>0&&f.width<=ee&&f.height>0&&f.height<=ye,"copy texture read out of bounds")}else if(!y)f.width=f.width||1,f.height=f.height||1,f.channels=f.channels||4;else if(de(y))f.channels=f.channels||4,f.data=y,!("type"in T)&&f.type===Wr&&(f.type=yi(y));else if(pi(y))f.channels=f.channels||4,vu(f,y),f.alignment=1,f.needsFree=!0;else if(fr(y)){var a=y.data;!Array.isArray(a)&&f.type===Wr&&(f.type=yi(a));var r=y.shape,c=y.stride,h,v,d,l,m,i;r.length===3?(d=r[2],i=c[2]):(n(r.length===2,"invalid ndarray pixel data, must be 2 or 3D"),d=1,i=1),h=r[0],v=r[1],l=c[0],m=c[1],f.alignment=1,f.width=h,f.height=v,f.channels=d,f.format=f.internalformat=Ht[d],f.needsFree=!0,bu(f,a,l,m,i,y.offset)}else if(bi(y)||_i(y)||du(y))bi(y)||_i(y)?f.element=y:f.element=y.canvas,f.width=f.element.width,f.height=f.element.height,f.channels=4;else if(mu(y))f.element=y,f.width=y.width,f.height=y.height,f.channels=4;else if(hu(y))f.element=y,f.width=y.naturalWidth,f.height=y.naturalHeight,f.channels=4;else if(pu(y))f.element=y,f.width=y.videoWidth,f.height=y.videoHeight,f.channels=4;else if(vi(y)){var s=f.width||y[0].length,o=f.height||y.length,_=f.channels;Re(y[0][0])?_=_||y[0][0].length:_=_||1;for(var b=Dt.shape(y),L=1,B=0;B<b.length;++B)L*=b[B];var H=Ei(f,L);Dt.flatten(y,b,"",H),Ai(f,H),f.alignment=1,f.width=s,f.height=o,f.channels=_,f.format=f.internalformat=Ht[_],f.needsFree=!0}f.type===dt?n(u.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):f.type===Yr&&n(u.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Y(f,T,y){var ee=f.element,ye=f.data,a=f.internalformat,r=f.format,c=f.type,h=f.width,v=f.height;$(f),ee?e.texImage2D(T,y,r,r,c,ee):f.compressed?e.compressedTexImage2D(T,y,a,h,v,0,ye):f.needsCopy?(x(),e.copyTexImage2D(T,y,r,f.xOffset,f.yOffset,h,v,0)):e.texImage2D(T,y,r,h,v,0,r,c,ye||null)}function me(f,T,y,ee,ye){var a=f.element,r=f.data,c=f.internalformat,h=f.format,v=f.type,d=f.width,l=f.height;$(f),a?e.texSubImage2D(T,ye,y,ee,h,v,a):f.compressed?e.compressedTexSubImage2D(T,ye,y,ee,c,d,l,r):f.needsCopy?(x(),e.copyTexSubImage2D(T,ye,y,ee,f.xOffset,f.yOffset,d,l)):e.texSubImage2D(T,ye,y,ee,d,l,h,v,r)}var le=[];function q(){return le.pop()||new I}function K(f){f.needsFree&&Ne.freeType(f.data),I.call(f),le.push(f)}function se(){O.call(this),this.genMipmaps=!1,this.mipmapHint=Vt,this.mipmask=0,this.images=Array(16)}function he(f,T,y){var ee=f.images[0]=q();f.mipmask=1,ee.width=f.width=T,ee.height=f.height=y,ee.channels=f.channels=4}function Ee(f,T){var y=null;if(In(T))y=f.images[0]=q(),R(y,f),X(y,T),f.mipmask=1;else if(re(f,T),Array.isArray(T.mipmap))for(var ee=T.mipmap,ye=0;ye<ee.length;++ye)y=f.images[ye]=q(),R(y,f),y.width>>=ye,y.height>>=ye,X(y,ee[ye]),f.mipmask|=1<<ye;else y=f.images[0]=q(),R(y,f),X(y,T),f.mipmask=1;R(f,f.images[0]),f.compressed&&(f.internalformat===Ln||f.internalformat===Rn||f.internalformat===Cn||f.internalformat===On)&&n(f.width%4==0&&f.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ce(f,T){for(var y=f.images,ee=0;ee<y.length;++ee){if(!y[ee])return;Y(y[ee],T,ee)}}var Be=[];function xe(){var f=Be.pop()||new se;O.call(f),f.mipmask=0;for(var T=0;T<16;++T)f.images[T]=null;return f}function Me(f){for(var T=f.images,y=0;y<T.length;++y)T[y]&&K(T[y]),T[y]=null;Be.push(f)}function Le(){this.minFilter=Nn,this.magFilter=Nn,this.wrapS=Gn,this.wrapT=Gn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vt}function Pe(f,T){if("min"in T){var y=T.min;n.parameter(y,V),f.minFilter=V[y],cu.indexOf(f.minFilter)>=0&&!("faces"in T)&&(f.genMipmaps=!0)}if("mag"in T){var ee=T.mag;n.parameter(ee,U),f.magFilter=U[ee]}var ye=f.wrapS,a=f.wrapT;if("wrap"in T){var r=T.wrap;typeof r=="string"?(n.parameter(r,N),ye=a=N[r]):Array.isArray(r)&&(n.parameter(r[0],N),n.parameter(r[1],N),ye=N[r[0]],a=N[r[1]])}else{if("wrapS"in T){var c=T.wrapS;n.parameter(c,N),ye=N[c]}if("wrapT"in T){var h=T.wrapT;n.parameter(h,N),a=N[h]}}if(f.wrapS=ye,f.wrapT=a,"anisotropic"in T){var v=T.anisotropic;n(typeof v=="number"&&v>=1&&v<=u.maxAnisotropic,"aniso samples must be between 1 and "),f.anisotropic=T.anisotropic}if("mipmap"in T){var d=!1;switch(typeof T.mipmap){case"string":n.parameter(T.mipmap,D,"invalid mipmap hint"),f.mipmapHint=D[T.mipmap],f.genMipmaps=!0,d=!0;break;case"boolean":d=f.genMipmaps=T.mipmap;break;case"object":n(Array.isArray(T.mipmap),"invalid mipmap type"),f.genMipmaps=!1,d=!0;break;default:n.raise("invalid mipmap type")}d&&!("min"in T)&&(f.minFilter=Dn)}}function ke(f,T){e.texParameteri(T,eu,f.minFilter),e.texParameteri(T,Js,f.magFilter),e.texParameteri(T,qs,f.wrapS),e.texParameteri(T,Qs,f.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(T,iu,f.anisotropic),f.genMipmaps&&(e.hint(tu,f.mipmapHint),e.generateMipmap(T))}var Ue=0,He={},$e=u.maxTextureUnits,Fe=Array($e).map(function(){return null});function be(f){O.call(this),this.mipmask=0,this.internalformat=Or,this.id=Ue++,this.refCount=1,this.target=f,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Le,S.profile&&(this.stats={size:0})}function Xe(f){e.activeTexture(mt),e.bindTexture(f.target,f.texture)}function Se(){var f=Fe[0];f?e.bindTexture(f.target,f.texture):e.bindTexture(cr,null)}function fe(f){var T=f.texture;n(T,"must not double destroy texture");var y=f.unit,ee=f.target;y>=0&&(e.activeTexture(mt+y),e.bindTexture(ee,null),Fe[y]=null),e.deleteTexture(T),f.texture=null,f.params=null,f.pixels=null,f.refCount=0,delete He[f.id],E.textureCount--}ae(be.prototype,{bind:function(){var f=this;f.bindCount+=1;var T=f.unit;if(T<0){for(var y=0;y<$e;++y){var ee=Fe[y];if(ee){if(ee.bindCount>0)continue;ee.unit=-1}Fe[y]=f,T=y;break}T>=$e&&n.raise("insufficient number of texture units"),S.profile&&E.maxTextureUnits<T+1&&(E.maxTextureUnits=T+1),f.unit=T,e.activeTexture(mt+T),e.bindTexture(f.target,f.texture)}return T},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&fe(this)}});function Ae(f,T){var y=new be(cr);He[y.id]=y,E.textureCount++;function ee(r,c){var h=y.texInfo;Le.call(h);var v=xe();return typeof r=="number"?typeof c=="number"?he(v,r|0,c|0):he(v,r|0,r|0):r?(n.type(r,"object","invalid arguments to regl.texture"),Pe(h,r),Ee(v,r)):he(v,1,1),h.genMipmaps&&(v.mipmask=(v.width<<1)-1),y.mipmask=v.mipmask,R(y,v),n.texture2D(h,v,u),y.internalformat=v.internalformat,ee.width=v.width,ee.height=v.height,Xe(y),Ce(v,cr),ke(h,cr),Se(),Me(v),S.profile&&(y.stats.size=zt(y.internalformat,y.type,v.width,v.height,h.genMipmaps,!1)),ee.format=M[y.internalformat],ee.type=Z[y.type],ee.mag=G[h.magFilter],ee.min=Q[h.minFilter],ee.wrapS=W[h.wrapS],ee.wrapT=W[h.wrapT],ee}function ye(r,c,h,v){n(!!r,"must specify image data");var d=c|0,l=h|0,m=v|0,i=q();return R(i,y),i.width=0,i.height=0,X(i,r),i.width=i.width||(y.width>>m)-d,i.height=i.height||(y.height>>m)-l,n(y.type===i.type&&y.format===i.format&&y.internalformat===i.internalformat,"incompatible format for texture.subimage"),n(d>=0&&l>=0&&d+i.width<=y.width&&l+i.height<=y.height,"texture.subimage write out of bounds"),n(y.mipmask&1<<m,"missing mipmap data"),n(i.data||i.element||i.needsCopy,"missing image data"),Xe(y),me(i,cr,d,l,m),Se(),K(i),ee}function a(r,c){var h=r|0,v=c|0||h;if(h===y.width&&v===y.height)return ee;ee.width=y.width=h,ee.height=y.height=v,Xe(y);for(var d=0;y.mipmask>>d;++d){var l=h>>d,m=v>>d;if(!l||!m)break;e.texImage2D(cr,d,y.format,l,m,0,y.format,y.type,null)}return Se(),S.profile&&(y.stats.size=zt(y.internalformat,y.type,h,v,!1,!1)),ee}return ee(f,T),ee.subimage=ye,ee.resize=a,ee._reglType="texture2d",ee._texture=y,S.profile&&(ee.stats=y.stats),ee.destroy=function(){y.decRef()},ee}function ge(f,T,y,ee,ye,a){var r=new be(An);He[r.id]=r,E.cubeCount++;var c=new Array(6);function h(l,m,i,s,o,_){var b,L=r.texInfo;for(Le.call(L),b=0;b<6;++b)c[b]=xe();if(typeof l=="number"||!l){var B=l|0||1;for(b=0;b<6;++b)he(c[b],B,B)}else if(typeof l=="object")if(m)Ee(c[0],l),Ee(c[1],m),Ee(c[2],i),Ee(c[3],s),Ee(c[4],o),Ee(c[5],_);else if(Pe(L,l),re(r,l),"faces"in l){var H=l.faces;for(n(Array.isArray(H)&&H.length===6,"cube faces must be a length 6 array"),b=0;b<6;++b)n(typeof H[b]=="object"&&!!H[b],"invalid input for cube map face"),R(c[b],r),Ee(c[b],H[b])}else for(b=0;b<6;++b)Ee(c[b],l);else n.raise("invalid arguments to cube map");for(R(r,c[0]),n.optional(function(){u.npotTextureCube||n(qa(r.width)&&qa(r.height),"your browser does not support non power or two texture dimensions")}),L.genMipmaps?r.mipmask=(c[0].width<<1)-1:r.mipmask=c[0].mipmask,n.textureCube(r,L,c,u),r.internalformat=c[0].internalformat,h.width=c[0].width,h.height=c[0].height,Xe(r),b=0;b<6;++b)Ce(c[b],Mt+b);for(ke(L,An),Se(),S.profile&&(r.stats.size=zt(r.internalformat,r.type,h.width,h.height,L.genMipmaps,!0)),h.format=M[r.internalformat],h.type=Z[r.type],h.mag=G[L.magFilter],h.min=Q[L.minFilter],h.wrapS=W[L.wrapS],h.wrapT=W[L.wrapT],b=0;b<6;++b)Me(c[b]);return h}function v(l,m,i,s,o){n(!!m,"must specify image data"),n(typeof l=="number"&&l===(l|0)&&l>=0&&l<6,"invalid face");var _=i|0,b=s|0,L=o|0,B=q();return R(B,r),B.width=0,B.height=0,X(B,m),B.width=B.width||(r.width>>L)-_,B.height=B.height||(r.height>>L)-b,n(r.type===B.type&&r.format===B.format&&r.internalformat===B.internalformat,"incompatible format for texture.subimage"),n(_>=0&&b>=0&&_+B.width<=r.width&&b+B.height<=r.height,"texture.subimage write out of bounds"),n(r.mipmask&1<<L,"missing mipmap data"),n(B.data||B.element||B.needsCopy,"missing image data"),Xe(r),me(B,Mt+l,_,b,L),Se(),K(B),h}function d(l){var m=l|0;if(m!==r.width){h.width=r.width=m,h.height=r.height=m,Xe(r);for(var i=0;i<6;++i)for(var s=0;r.mipmask>>s;++s)e.texImage2D(Mt+i,s,r.format,m>>s,m>>s,0,r.format,r.type,null);return Se(),S.profile&&(r.stats.size=zt(r.internalformat,r.type,h.width,h.height,!1,!0)),h}}return h(f,T,y,ee,ye,a),h.subimage=v,h.resize=d,h._reglType="textureCube",h._texture=r,S.profile&&(h.stats=r.stats),h.destroy=function(){r.decRef()},h}function Ge(){for(var f=0;f<$e;++f)e.activeTexture(mt+f),e.bindTexture(cr,null),Fe[f]=null;rr(He).forEach(fe),E.cubeCount=0,E.textureCount=0}S.profile&&(E.getTotalTextureSize=function(){var f=0;return Object.keys(He).forEach(function(T){f+=He[T].stats.size}),f});function dr(){for(var f=0;f<$e;++f){var T=Fe[f];T&&(T.bindCount=0,T.unit=-1,Fe[f]=null)}rr(He).forEach(function(y){y.texture=e.createTexture(),e.bindTexture(y.target,y.texture);for(var ee=0;ee<32;++ee)if((y.mipmask&1<<ee)!=0)if(y.target===cr)e.texImage2D(cr,ee,y.internalformat,y.width>>ee,y.height>>ee,0,y.internalformat,y.type,null);else for(var ye=0;ye<6;++ye)e.texImage2D(Mt+ye,ee,y.internalformat,y.width>>ee,y.height>>ee,0,y.internalformat,y.type,null);ke(y.texInfo,y.target)})}function Mr(){for(var f=0;f<$e;++f){var T=Fe[f];T&&(T.bindCount=0,T.unit=-1,Fe[f]=null),e.activeTexture(mt+f),e.bindTexture(cr,null),e.bindTexture(An,null)}}return{create2D:Ae,createCube:ge,clear:Ge,getTexture:function(f){return null},restore:dr,refresh:Mr}}var xr=36161,$t=32854,xi=32855,Ti=36194,gi=33189,Si=36168,wi=34041,Li=35907,Ri=34836,Ci=34842,Oi=34843,sr=[];sr[$t]=2,sr[xi]=2,sr[Ti]=2,sr[gi]=2,sr[Si]=1,sr[wi]=4,sr[Li]=4,sr[Ri]=16,sr[Ci]=8,sr[Oi]=6;function Bi(e,t,u){return sr[e]*t*u}var yu=function(e,t,u,x,C){var E={rgba4:$t,rgb565:Ti,"rgb5 a1":xi,depth:gi,stencil:Si,"depth stencil":wi};t.ext_srgb&&(E.srgba=Li),t.ext_color_buffer_half_float&&(E.rgba16f=Ci,E.rgb16f=Oi),t.webgl_color_buffer_float&&(E.rgba32f=Ri);var S=[];Object.keys(E).forEach(function(P){var k=E[P];S[k]=P});var D=0,N={};function U(P){this.id=D++,this.refCount=1,this.renderbuffer=P,this.format=$t,this.width=0,this.height=0,C.profile&&(this.stats={size:0})}U.prototype.decRef=function(){--this.refCount<=0&&V(this)};function V(P){var k=P.renderbuffer;n(k,"must not double destroy renderbuffer"),e.bindRenderbuffer(xr,null),e.deleteRenderbuffer(k),P.renderbuffer=null,P.refCount=0,delete N[P.id],x.renderbufferCount--}function j(P,k){var p=new U(e.createRenderbuffer());N[p.id]=p,x.renderbufferCount++;function g(Z,G){var Q=0,W=0,oe=$t;if(typeof Z=="object"&&Z){var O=Z;if("shape"in O){var R=O.shape;n(Array.isArray(R)&&R.length>=2,"invalid renderbuffer shape"),Q=R[0]|0,W=R[1]|0}else"radius"in O&&(Q=W=O.radius|0),"width"in O&&(Q=O.width|0),"height"in O&&(W=O.height|0);"format"in O&&(n.parameter(O.format,E,"invalid renderbuffer format"),oe=E[O.format])}else typeof Z=="number"?(Q=Z|0,typeof G=="number"?W=G|0:W=Q):Z?n.raise("invalid arguments to renderbuffer constructor"):Q=W=1;if(n(Q>0&&W>0&&Q<=u.maxRenderbufferSize&&W<=u.maxRenderbufferSize,"invalid renderbuffer size"),!(Q===p.width&&W===p.height&&oe===p.format))return g.width=p.width=Q,g.height=p.height=W,p.format=oe,e.bindRenderbuffer(xr,p.renderbuffer),e.renderbufferStorage(xr,oe,Q,W),n(e.getError()===0,"invalid render buffer format"),C.profile&&(p.stats.size=Bi(p.format,p.width,p.height)),g.format=S[p.format],g}function M(Z,G){var Q=Z|0,W=G|0||Q;return Q===p.width&&W===p.height||(n(Q>0&&W>0&&Q<=u.maxRenderbufferSize&&W<=u.maxRenderbufferSize,"invalid renderbuffer size"),g.width=p.width=Q,g.height=p.height=W,e.bindRenderbuffer(xr,p.renderbuffer),e.renderbufferStorage(xr,p.format,Q,W),n(e.getError()===0,"invalid render buffer format"),C.profile&&(p.stats.size=Bi(p.format,p.width,p.height))),g}return g(P,k),g.resize=M,g._reglType="renderbuffer",g._renderbuffer=p,C.profile&&(g.stats=p.stats),g.destroy=function(){p.decRef()},g}C.profile&&(x.getTotalRenderbufferSize=function(){var P=0;return Object.keys(N).forEach(function(k){P+=N[k].stats.size}),P});function z(){rr(N).forEach(function(P){P.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(xr,P.renderbuffer),e.renderbufferStorage(xr,P.format,P.width,P.height)}),e.bindRenderbuffer(xr,null)}return{create:j,clear:function(){rr(N).forEach(V)},restore:z}},pr=36160,Mn=36161,Fr=3553,Xt=34069,Fi=36064,Gi=36096,Ni=36128,Di=33306,Pi=36053,Eu=36054,Au=36055,xu=36057,Tu=36061,gu=36193,Su=5121,wu=5126,Ii=6407,Mi=6408,Lu=6402,Ru=[Ii,Mi],kn=[];kn[Mi]=4,kn[Ii]=3;var Yt=[];Yt[Su]=1,Yt[wu]=4,Yt[gu]=2;var Cu=32854,Ou=32855,Bu=36194,Fu=33189,Gu=36168,ki=34041,Nu=35907,Du=34836,Pu=34842,Iu=34843,Mu=[Cu,Ou,Bu,Nu,Pu,Iu,Du],Kr={};Kr[Pi]="complete",Kr[Eu]="incomplete attachment",Kr[xu]="incomplete dimensions",Kr[Au]="incomplete, missing attachment",Kr[Tu]="unsupported";function ku(e,t,u,x,C,E){var S={cur:null,next:null,dirty:!1,setFBO:null},D=["rgba"],N=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&N.push("srgba"),t.ext_color_buffer_half_float&&N.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&N.push("rgba32f");var U=["uint8"];t.oes_texture_half_float&&U.push("half float","float16"),t.oes_texture_float&&U.push("float","float32");function V(I,X,Y){this.target=I,this.texture=X,this.renderbuffer=Y;var me=0,le=0;X?(me=X.width,le=X.height):Y&&(me=Y.width,le=Y.height),this.width=me,this.height=le}function j(I){I&&(I.texture&&I.texture._texture.decRef(),I.renderbuffer&&I.renderbuffer._renderbuffer.decRef())}function z(I,X,Y){if(!!I)if(I.texture){var me=I.texture._texture,le=Math.max(1,me.width),q=Math.max(1,me.height);n(le===X&&q===Y,"inconsistent width/height for supplied texture"),me.refCount+=1}else{var K=I.renderbuffer._renderbuffer;n(K.width===X&&K.height===Y,"inconsistent width/height for renderbuffer"),K.refCount+=1}}function P(I,X){X&&(X.texture?e.framebufferTexture2D(pr,I,X.target,X.texture._texture.texture,0):e.framebufferRenderbuffer(pr,I,Mn,X.renderbuffer._renderbuffer.renderbuffer))}function k(I){var X=Fr,Y=null,me=null,le=I;typeof I=="object"&&(le=I.data,"target"in I&&(X=I.target|0)),n.type(le,"function","invalid attachment data");var q=le._reglType;return q==="texture2d"?(Y=le,n(X===Fr)):q==="textureCube"?(Y=le,n(X>=Xt&&X<Xt+6,"invalid cube map target")):q==="renderbuffer"?(me=le,X=Mn):n.raise("invalid regl object for attachment"),new V(X,Y,me)}function p(I,X,Y,me,le){if(Y){var q=x.create2D({width:I,height:X,format:me,type:le});return q._texture.refCount=0,new V(Fr,q,null)}else{var K=C.create({width:I,height:X,format:me});return K._renderbuffer.refCount=0,new V(Mn,null,K)}}function g(I){return I&&(I.texture||I.renderbuffer)}function M(I,X,Y){I&&(I.texture?I.texture.resize(X,Y):I.renderbuffer&&I.renderbuffer.resize(X,Y),I.width=X,I.height=Y)}var Z=0,G={};function Q(){this.id=Z++,G[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function W(I){I.colorAttachments.forEach(j),j(I.depthAttachment),j(I.stencilAttachment),j(I.depthStencilAttachment)}function oe(I){var X=I.framebuffer;n(X,"must not double destroy framebuffer"),e.deleteFramebuffer(X),I.framebuffer=null,E.framebufferCount--,delete G[I.id]}function O(I){var X;e.bindFramebuffer(pr,I.framebuffer);var Y=I.colorAttachments;for(X=0;X<Y.length;++X)P(Fi+X,Y[X]);for(X=Y.length;X<u.maxColorAttachments;++X)e.framebufferTexture2D(pr,Fi+X,Fr,null,0);e.framebufferTexture2D(pr,Di,Fr,null,0),e.framebufferTexture2D(pr,Gi,Fr,null,0),e.framebufferTexture2D(pr,Ni,Fr,null,0),P(Gi,I.depthAttachment),P(Ni,I.stencilAttachment),P(Di,I.depthStencilAttachment);var me=e.checkFramebufferStatus(pr);!e.isContextLost()&&me!==Pi&&n.raise("framebuffer configuration not supported, status = "+Kr[me]),e.bindFramebuffer(pr,S.next?S.next.framebuffer:null),S.cur=S.next,e.getError()}function R(I,X){var Y=new Q;E.framebufferCount++;function me(q,K){var se;n(S.next!==Y,"can not update framebuffer which is currently in use");var he=0,Ee=0,Ce=!0,Be=!0,xe=null,Me=!0,Le="rgba",Pe="uint8",ke=1,Ue=null,He=null,$e=null,Fe=!1;if(typeof q=="number")he=q|0,Ee=K|0||he;else if(!q)he=Ee=1;else{n.type(q,"object","invalid arguments for framebuffer");var be=q;if("shape"in be){var Xe=be.shape;n(Array.isArray(Xe)&&Xe.length>=2,"invalid shape for framebuffer"),he=Xe[0],Ee=Xe[1]}else"radius"in be&&(he=Ee=be.radius),"width"in be&&(he=be.width),"height"in be&&(Ee=be.height);("color"in be||"colors"in be)&&(xe=be.color||be.colors,Array.isArray(xe)&&n(xe.length===1||t.webgl_draw_buffers,"multiple render targets not supported")),xe||("colorCount"in be&&(ke=be.colorCount|0,n(ke>0,"invalid color buffer count")),"colorTexture"in be&&(Me=!!be.colorTexture,Le="rgba4"),"colorType"in be&&(Pe=be.colorType,Me?(n(t.oes_texture_float||!(Pe==="float"||Pe==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),n(t.oes_texture_half_float||!(Pe==="half float"||Pe==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Pe==="half float"||Pe==="float16"?(n(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Le="rgba16f"):(Pe==="float"||Pe==="float32")&&(n(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Le="rgba32f"),n.oneOf(Pe,U,"invalid color type")),"colorFormat"in be&&(Le=be.colorFormat,D.indexOf(Le)>=0?Me=!0:N.indexOf(Le)>=0?Me=!1:n.optional(function(){Me?n.oneOf(be.colorFormat,D,"invalid color format for texture"):n.oneOf(be.colorFormat,N,"invalid color format for renderbuffer")}))),("depthTexture"in be||"depthStencilTexture"in be)&&(Fe=!!(be.depthTexture||be.depthStencilTexture),n(!Fe||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in be&&(typeof be.depth=="boolean"?Ce=be.depth:(Ue=be.depth,Be=!1)),"stencil"in be&&(typeof be.stencil=="boolean"?Be=be.stencil:(He=be.stencil,Ce=!1)),"depthStencil"in be&&(typeof be.depthStencil=="boolean"?Ce=Be=be.depthStencil:($e=be.depthStencil,Ce=!1,Be=!1))}var Se=null,fe=null,Ae=null,ge=null;if(Array.isArray(xe))Se=xe.map(k);else if(xe)Se=[k(xe)];else for(Se=new Array(ke),se=0;se<ke;++se)Se[se]=p(he,Ee,Me,Le,Pe);n(t.webgl_draw_buffers||Se.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),n(Se.length<=u.maxColorAttachments,"too many color attachments, not supported"),he=he||Se[0].width,Ee=Ee||Se[0].height,Ue?fe=k(Ue):Ce&&!Be&&(fe=p(he,Ee,Fe,"depth","uint32")),He?Ae=k(He):Be&&!Ce&&(Ae=p(he,Ee,!1,"stencil","uint8")),$e?ge=k($e):!Ue&&!He&&Be&&Ce&&(ge=p(he,Ee,Fe,"depth stencil","depth stencil")),n(!!Ue+!!He+!!$e<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ge=null;for(se=0;se<Se.length;++se)if(z(Se[se],he,Ee),n(!Se[se]||Se[se].texture&&Ru.indexOf(Se[se].texture._texture.format)>=0||Se[se].renderbuffer&&Mu.indexOf(Se[se].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+se+" is invalid"),Se[se]&&Se[se].texture){var dr=kn[Se[se].texture._texture.format]*Yt[Se[se].texture._texture.type];Ge===null?Ge=dr:n(Ge===dr,"all color attachments much have the same number of bits per pixel.")}return z(fe,he,Ee),n(!fe||fe.texture&&fe.texture._texture.format===Lu||fe.renderbuffer&&fe.renderbuffer._renderbuffer.format===Fu,"invalid depth attachment for framebuffer object"),z(Ae,he,Ee),n(!Ae||Ae.renderbuffer&&Ae.renderbuffer._renderbuffer.format===Gu,"invalid stencil attachment for framebuffer object"),z(ge,he,Ee),n(!ge||ge.texture&&ge.texture._texture.format===ki||ge.renderbuffer&&ge.renderbuffer._renderbuffer.format===ki,"invalid depth-stencil attachment for framebuffer object"),W(Y),Y.width=he,Y.height=Ee,Y.colorAttachments=Se,Y.depthAttachment=fe,Y.stencilAttachment=Ae,Y.depthStencilAttachment=ge,me.color=Se.map(g),me.depth=g(fe),me.stencil=g(Ae),me.depthStencil=g(ge),me.width=Y.width,me.height=Y.height,O(Y),me}function le(q,K){n(S.next!==Y,"can not resize a framebuffer which is currently in use");var se=Math.max(q|0,1),he=Math.max(K|0||se,1);if(se===Y.width&&he===Y.height)return me;for(var Ee=Y.colorAttachments,Ce=0;Ce<Ee.length;++Ce)M(Ee[Ce],se,he);return M(Y.depthAttachment,se,he),M(Y.stencilAttachment,se,he),M(Y.depthStencilAttachment,se,he),Y.width=me.width=se,Y.height=me.height=he,O(Y),me}return me(I,X),ae(me,{resize:le,_reglType:"framebuffer",_framebuffer:Y,destroy:function(){oe(Y),W(Y)},use:function(q){S.setFBO({framebuffer:me},q)}})}function re(I){var X=Array(6);function Y(le){var q;n(X.indexOf(S.next)<0,"can not update framebuffer which is currently in use");var K={color:null},se=0,he=null,Ee="rgba",Ce="uint8",Be=1;if(typeof le=="number")se=le|0;else if(!le)se=1;else{n.type(le,"object","invalid arguments for framebuffer");var xe=le;if("shape"in xe){var Me=xe.shape;n(Array.isArray(Me)&&Me.length>=2,"invalid shape for framebuffer"),n(Me[0]===Me[1],"cube framebuffer must be square"),se=Me[0]}else"radius"in xe&&(se=xe.radius|0),"width"in xe?(se=xe.width|0,"height"in xe&&n(xe.height===se,"must be square")):"height"in xe&&(se=xe.height|0);("color"in xe||"colors"in xe)&&(he=xe.color||xe.colors,Array.isArray(he)&&n(he.length===1||t.webgl_draw_buffers,"multiple render targets not supported")),he||("colorCount"in xe&&(Be=xe.colorCount|0,n(Be>0,"invalid color buffer count")),"colorType"in xe&&(n.oneOf(xe.colorType,U,"invalid color type"),Ce=xe.colorType),"colorFormat"in xe&&(Ee=xe.colorFormat,n.oneOf(xe.colorFormat,D,"invalid color format for texture"))),"depth"in xe&&(K.depth=xe.depth),"stencil"in xe&&(K.stencil=xe.stencil),"depthStencil"in xe&&(K.depthStencil=xe.depthStencil)}var Le;if(he)if(Array.isArray(he))for(Le=[],q=0;q<he.length;++q)Le[q]=he[q];else Le=[he];else{Le=Array(Be);var Pe={radius:se,format:Ee,type:Ce};for(q=0;q<Be;++q)Le[q]=x.createCube(Pe)}for(K.color=Array(Le.length),q=0;q<Le.length;++q){var ke=Le[q];n(typeof ke=="function"&&ke._reglType==="textureCube","invalid cube map"),se=se||ke.width,n(ke.width===se&&ke.height===se,"invalid cube map shape"),K.color[q]={target:Xt,data:Le[q]}}for(q=0;q<6;++q){for(var Ue=0;Ue<Le.length;++Ue)K.color[Ue].target=Xt+q;q>0&&(K.depth=X[0].depth,K.stencil=X[0].stencil,K.depthStencil=X[0].depthStencil),X[q]?X[q](K):X[q]=R(K)}return ae(Y,{width:se,height:se,color:Le})}function me(le){var q,K=le|0;if(n(K>0&&K<=u.maxCubeMapSize,"invalid radius for cube fbo"),K===Y.width)return Y;var se=Y.color;for(q=0;q<se.length;++q)se[q].resize(K);for(q=0;q<6;++q)X[q].resize(K);return Y.width=Y.height=K,Y}return Y(I),ae(Y,{faces:X,resize:me,_reglType:"framebufferCube",destroy:function(){X.forEach(function(le){le.destroy()})}})}function $(){S.cur=null,S.next=null,S.dirty=!0,rr(G).forEach(function(I){I.framebuffer=e.createFramebuffer(),O(I)})}return ae(S,{getFramebuffer:function(I){if(typeof I=="function"&&I._reglType==="framebuffer"){var X=I._framebuffer;if(X instanceof Q)return X}return null},create:R,createCube:re,clear:function(){rr(G).forEach(oe)},restore:$})}var Uu=5126,Ui=34962,Wt=34963,ji=["attributes","elements","offset","count","primitive","instances"];function Un(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Uu,this.offset=0,this.stride=0,this.divisor=0}function ju(e,t,u,x,C,E,S){for(var D=u.maxAttributes,N=new Array(D),U=0;U<D;++U)N[U]=new Un;var V=0,j={},z={Record:Un,scope:{},state:N,currentVAO:null,targetVAO:null,restore:k()?W:function(){},createVAO:oe,getVAO:g,destroyBuffer:P,setVAO:k()?M:Z,clear:k()?G:function(){}};function P(O){for(var R=0;R<N.length;++R){var re=N[R];re.buffer===O&&(e.disableVertexAttribArray(R),re.buffer=null)}}function k(){return t.oes_vertex_array_object}function p(){return t.angle_instanced_arrays}function g(O){return typeof O=="function"&&O._vao?O._vao:null}function M(O){if(O!==z.currentVAO){var R=k();O?R.bindVertexArrayOES(O.vao):R.bindVertexArrayOES(null),z.currentVAO=O}}function Z(O){if(O!==z.currentVAO){if(O)O.bindAttrs();else{for(var R=p(),re=0;re<N.length;++re){var $=N[re];$.buffer?(e.enableVertexAttribArray(re),$.buffer.bind(),e.vertexAttribPointer(re,$.size,$.type,$.normalized,$.stride,$.offfset),R&&$.divisor&&R.vertexAttribDivisorANGLE(re,$.divisor)):(e.disableVertexAttribArray(re),e.vertexAttrib4f(re,$.x,$.y,$.z,$.w))}S.elements?e.bindBuffer(Wt,S.elements.buffer.buffer):e.bindBuffer(Wt,null)}z.currentVAO=O}}function G(){rr(j).forEach(function(O){O.destroy()})}function Q(){this.id=++V,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var O=k();O?this.vao=O.createVertexArrayOES():this.vao=null,j[this.id]=this,this.buffers=[]}Q.prototype.bindAttrs=function(){for(var O=p(),R=this.attributes,re=0;re<R.length;++re){var $=R[re];$.buffer?(e.enableVertexAttribArray(re),e.bindBuffer(Ui,$.buffer.buffer),e.vertexAttribPointer(re,$.size,$.type,$.normalized,$.stride,$.offset),O&&$.divisor&&O.vertexAttribDivisorANGLE(re,$.divisor)):(e.disableVertexAttribArray(re),e.vertexAttrib4f(re,$.x,$.y,$.z,$.w))}for(var I=R.length;I<D;++I)e.disableVertexAttribArray(I);var X=E.getElements(this.elements);X?e.bindBuffer(Wt,X.buffer.buffer):e.bindBuffer(Wt,null)},Q.prototype.refresh=function(){var O=k();O&&(O.bindVertexArrayOES(this.vao),this.bindAttrs(),z.currentVAO=null,O.bindVertexArrayOES(null))},Q.prototype.destroy=function(){if(this.vao){var O=k();this===z.currentVAO&&(z.currentVAO=null,O.bindVertexArrayOES(null)),O.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),j[this.id]&&(delete j[this.id],x.vaoCount-=1)};function W(){var O=k();O&&rr(j).forEach(function(R){R.refresh()})}function oe(O){var R=new Q;x.vaoCount+=1;function re($){var I;if(Array.isArray($))I=$,R.elements&&R.ownsElements&&R.elements.destroy(),R.elements=null,R.ownsElements=!1,R.offset=0,R.count=0,R.instances=-1,R.primitive=4;else{if(n(typeof $=="object","invalid arguments for create vao"),n("attributes"in $,"must specify attributes for vao"),$.elements){var X=$.elements;R.ownsElements?typeof X=="function"&&X._reglType==="elements"?(R.elements.destroy(),R.ownsElements=!1):(R.elements(X),R.ownsElements=!1):E.getElements($.elements)?(R.elements=$.elements,R.ownsElements=!1):(R.elements=E.create($.elements),R.ownsElements=!0)}else R.elements=null,R.ownsElements=!1;I=$.attributes,R.offset=0,R.count=-1,R.instances=-1,R.primitive=4,R.elements&&(R.count=R.elements._elements.vertCount,R.primitive=R.elements._elements.primType),"offset"in $&&(R.offset=$.offset|0),"count"in $&&(R.count=$.count|0),"instances"in $&&(R.instances=$.instances|0),"primitive"in $&&(n($.primitive in Ar,"bad primitive type: "+$.primitive),R.primitive=Ar[$.primitive]),n.optional(()=>{for(var Ce=Object.keys($),Be=0;Be<Ce.length;++Be)n(ji.indexOf(Ce[Be])>=0,'invalid option for vao: "'+Ce[Be]+'" valid options are '+ji)}),n(Array.isArray(I),"attributes must be an array")}n(I.length<D,"too many attributes"),n(I.length>0,"must specify at least one attribute");var Y={},me=R.attributes;me.length=I.length;for(var le=0;le<I.length;++le){var q=I[le],K=me[le]=new Un,se=q.data||q;if(Array.isArray(se)||de(se)||fr(se)){var he;R.buffers[le]&&(he=R.buffers[le],de(se)&&he._buffer.byteLength>=se.byteLength?he.subdata(se):(he.destroy(),R.buffers[le]=null)),R.buffers[le]||(he=R.buffers[le]=C.create(q,Ui,!1,!0)),K.buffer=C.getBuffer(he),K.size=K.buffer.dimension|0,K.normalized=!1,K.type=K.buffer.dtype,K.offset=0,K.stride=0,K.divisor=0,K.state=1,Y[le]=1}else C.getBuffer(q)?(K.buffer=C.getBuffer(q),K.size=K.buffer.dimension|0,K.normalized=!1,K.type=K.buffer.dtype,K.offset=0,K.stride=0,K.divisor=0,K.state=1):C.getBuffer(q.buffer)?(K.buffer=C.getBuffer(q.buffer),K.size=(+q.size||K.buffer.dimension)|0,K.normalized=!!q.normalized||!1,"type"in q?(n.parameter(q.type,Rr,"invalid buffer type"),K.type=Rr[q.type]):K.type=K.buffer.dtype,K.offset=(q.offset||0)|0,K.stride=(q.stride||0)|0,K.divisor=(q.divisor||0)|0,K.state=1,n(K.size>=1&&K.size<=4,"size must be between 1 and 4"),n(K.offset>=0,"invalid offset"),n(K.stride>=0&&K.stride<=255,"stride must be between 0 and 255"),n(K.divisor>=0,"divisor must be positive"),n(!K.divisor||!!t.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in q?(n(le>0,"first attribute must not be a constant"),K.x=+q.x||0,K.y=+q.y||0,K.z=+q.z||0,K.w=+q.w||0,K.state=2):n(!1,"invalid attribute spec for location "+le)}for(var Ee=0;Ee<R.buffers.length;++Ee)!Y[Ee]&&R.buffers[Ee]&&(R.buffers[Ee].destroy(),R.buffers[Ee]=null);return R.refresh(),re}return re.destroy=function(){for(var $=0;$<R.buffers.length;++$)R.buffers[$]&&R.buffers[$].destroy();R.buffers.length=0,R.ownsElements&&(R.elements.destroy(),R.elements=null,R.ownsElements=!1),R.destroy()},re._vao=R,re._reglType="vao",re(O)}return z}var Vi=35632,Vu=35633,Hu=35718,zu=35721;function $u(e,t,u,x){var C={},E={};function S(p,g,M,Z){this.name=p,this.id=g,this.location=M,this.info=Z}function D(p,g){for(var M=0;M<p.length;++M)if(p[M].id===g.id){p[M].location=g.location;return}p.push(g)}function N(p,g,M){var Z=p===Vi?C:E,G=Z[g];if(!G){var Q=t.str(g);G=e.createShader(p),e.shaderSource(G,Q),e.compileShader(G),n.shaderError(e,G,Q,p,M),Z[g]=G}return G}var U={},V=[],j=0;function z(p,g){this.id=j++,this.fragId=p,this.vertId=g,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,x.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function P(p,g,M){var Z,G,Q=N(Vi,p.fragId),W=N(Vu,p.vertId),oe=p.program=e.createProgram();if(e.attachShader(oe,Q),e.attachShader(oe,W),M)for(Z=0;Z<M.length;++Z){var O=M[Z];e.bindAttribLocation(oe,O[0],O[1])}e.linkProgram(oe),n.linkError(e,oe,t.str(p.fragId),t.str(p.vertId),g);var R=e.getProgramParameter(oe,Hu);x.profile&&(p.stats.uniformsCount=R);var re=p.uniforms;for(Z=0;Z<R;++Z)if(G=e.getActiveUniform(oe,Z),G){if(G.size>1)for(var $=0;$<G.size;++$){var I=G.name.replace("[0]","["+$+"]");D(re,new S(I,t.id(I),e.getUniformLocation(oe,I),G))}var X=G.name;G.size>1&&(X=X.replace("[0]","")),D(re,new S(X,t.id(X),e.getUniformLocation(oe,X),G))}var Y=e.getProgramParameter(oe,zu);x.profile&&(p.stats.attributesCount=Y);var me=p.attributes;for(Z=0;Z<Y;++Z)G=e.getActiveAttrib(oe,Z),G&&D(me,new S(G.name,t.id(G.name),e.getAttribLocation(oe,G.name),G))}x.profile&&(u.getMaxUniformsCount=function(){var p=0;return V.forEach(function(g){g.stats.uniformsCount>p&&(p=g.stats.uniformsCount)}),p},u.getMaxAttributesCount=function(){var p=0;return V.forEach(function(g){g.stats.attributesCount>p&&(p=g.stats.attributesCount)}),p});function k(){C={},E={};for(var p=0;p<V.length;++p)P(V[p],null,V[p].attributes.map(function(g){return[g.location,g.name]}))}return{clear:function(){var p=e.deleteShader.bind(e);rr(C).forEach(p),C={},rr(E).forEach(p),E={},V.forEach(function(g){e.deleteProgram(g.program)}),V.length=0,U={},u.shaderCount=0},program:function(p,g,M,Z){n.command(p>=0,"missing vertex shader",M),n.command(g>=0,"missing fragment shader",M);var G=U[g];G||(G=U[g]={});var Q=G[p];if(Q&&(Q.refCount++,!Z))return Q;var W=new z(g,p);return u.shaderCount++,P(W,M,Z),Q||(G[p]=W),V.push(W),ae(W,{destroy:function(){if(W.refCount--,W.refCount<=0){e.deleteProgram(W.program);var oe=V.indexOf(W);V.splice(oe,1),u.shaderCount--}G[W.vertId].refCount<=0&&(e.deleteShader(E[W.vertId]),delete E[W.vertId],delete U[W.fragId][W.vertId]),Object.keys(U[W.fragId]).length||(e.deleteShader(C[W.fragId]),delete C[W.fragId],delete U[W.fragId])}})},restore:k,shader:N,frag:-1,vert:-1}}var Xu=6408,ht=5121,Yu=3333,qt=5126;function Wu(e,t,u,x,C,E,S){function D(V){var j;t.next===null?(n(C.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),j=ht):(n(t.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),j=t.next.colorAttachments[0].texture._texture.type,n.optional(function(){E.oes_texture_float?(n(j===ht||j===qt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),j===qt&&n(S.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):n(j===ht,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var z=0,P=0,k=x.framebufferWidth,p=x.framebufferHeight,g=null;de(V)?g=V:V&&(n.type(V,"object","invalid arguments to regl.read()"),z=V.x|0,P=V.y|0,n(z>=0&&z<x.framebufferWidth,"invalid x offset for regl.read"),n(P>=0&&P<x.framebufferHeight,"invalid y offset for regl.read"),k=(V.width||x.framebufferWidth-z)|0,p=(V.height||x.framebufferHeight-P)|0,g=V.data||null),g&&(j===ht?n(g instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):j===qt&&n(g instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),n(k>0&&k+z<=x.framebufferWidth,"invalid width for read pixels"),n(p>0&&p+P<=x.framebufferHeight,"invalid height for read pixels"),u();var M=k*p*4;return g||(j===ht?g=new Uint8Array(M):j===qt&&(g=g||new Float32Array(M))),n.isTypedArray(g,"data buffer for regl.read() must be a typedarray"),n(g.byteLength>=M,"data buffer for regl.read() too small"),e.pixelStorei(Yu,4),e.readPixels(z,P,k,p,Xu,j,g),g}function N(V){var j;return t.setFBO({framebuffer:V.framebuffer},function(){j=D(V)}),j}function U(V){return!V||!("framebuffer"in V)?D(V):N(V)}return U}function Zr(e){return Array.prototype.slice.call(e)}function Jr(e){return Zr(e).join("")}function qu(){var e=0,t=[],u=[];function x(j){for(var z=0;z<u.length;++z)if(u[z]===j)return t[z];var P="g"+e++;return t.push(P),u.push(j),P}function C(){var j=[];function z(){j.push.apply(j,Zr(arguments))}var P=[];function k(){var p="v"+e++;return P.push(p),arguments.length>0&&(j.push(p,"="),j.push.apply(j,Zr(arguments)),j.push(";")),p}return ae(z,{def:k,toString:function(){return Jr([P.length>0?"var "+P.join(",")+";":"",Jr(j)])}})}function E(){var j=C(),z=C(),P=j.toString,k=z.toString;function p(g,M){z(g,M,"=",j.def(g,M),";")}return ae(function(){j.apply(j,Zr(arguments))},{def:j.def,entry:j,exit:z,save:p,set:function(g,M,Z){p(g,M),j(g,M,"=",Z,";")},toString:function(){return P()+k()}})}function S(){var j=Jr(arguments),z=E(),P=E(),k=z.toString,p=P.toString;return ae(z,{then:function(){return z.apply(z,Zr(arguments)),this},else:function(){return P.apply(P,Zr(arguments)),this},toString:function(){var g=p();return g&&(g="else{"+g+"}"),Jr(["if(",j,"){",k(),"}",g])}})}var D=C(),N={};function U(j,z){var P=[];function k(){var G="a"+P.length;return P.push(G),G}z=z||0;for(var p=0;p<z;++p)k();var g=E(),M=g.toString,Z=N[j]=ae(g,{arg:k,toString:function(){return Jr(["function(",P.join(),"){",M(),"}"])}});return Z}function V(){var j=['"use strict";',D,"return {"];Object.keys(N).forEach(function(k){j.push('"',k,'":',N[k].toString(),",")}),j.push("}");var z=Jr(j).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),P=Function.apply(null,t.concat(z));return P.apply(null,u)}return{global:D,link:x,block:C,proc:U,scope:E,cond:S,compile:V}}var et="xyzw".split(""),Hi=5121,rt=1,jn=2,Vn=0,Hn=1,zn=2,$n=3,Qt=4,zi=5,$i=6,Xi="dither",Yi="blend.enable",Wi="blend.color",Xn="blend.equation",Yn="blend.func",qi="depth.enable",Qi="depth.func",Ki="depth.range",Zi="depth.mask",Wn="colorMask",Ji="cull.enable",eo="cull.face",qn="frontFace",Qn="lineWidth",ro="polygonOffset.enable",Kn="polygonOffset.offset",to="sample.alpha",no="sample.enable",Zn="sample.coverage",ao="stencil.enable",io="stencil.mask",Jn="stencil.func",ea="stencil.opFront",pt="stencil.opBack",oo="scissor.enable",Kt="scissor.box",vr="viewport",vt="profile",Gr="framebuffer",bt="vert",_t="frag",Nr="elements",Dr="primitive",Pr="count",Zt="offset",Jt="instances",yt="vao",ra="Width",ta="Height",tt=Gr+ra,nt=Gr+ta,Qu=vr+ra,Ku=vr+ta,fo="drawingBuffer",so=fo+ra,uo=fo+ta,Zu=[Yn,Xn,Jn,ea,pt,Zn,vr,Kt,Kn],at=34962,na=34963,Ju=35632,ec=35633,co=3553,rc=34067,tc=2884,nc=3042,ac=3024,ic=2960,oc=2929,fc=3089,sc=32823,uc=32926,cc=32928,aa=5126,en=35664,rn=35665,tn=35666,ia=5124,nn=35667,an=35668,on=35669,oa=35670,fn=35671,sn=35672,un=35673,Et=35674,At=35675,xt=35676,Tt=35678,gt=35680,fa=4,St=1028,Ir=1029,lo=2304,sa=2305,lc=32775,dc=32776,mc=519,Tr=7680,mo=0,ho=1,po=32774,hc=513,vo=36160,pc=36064,lr={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},bo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],it={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},gr={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},_o={frag:Ju,vert:ec},ua={cw:lo,ccw:sa};function cn(e){return Array.isArray(e)||de(e)||fr(e)}function yo(e){return e.sort(function(t,u){return t===vr?-1:u===vr?1:t<u?-1:1})}function je(e,t,u,x){this.thisDep=e,this.contextDep=t,this.propDep=u,this.append=x}function Sr(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function De(e){return new je(!1,!1,!1,e)}function Qe(e,t){var u=e.type;if(u===Vn){var x=e.data.length;return new je(!0,x>=1,x>=2,t)}else if(u===Qt){var C=e.data;return new je(C.thisDep,C.contextDep,C.propDep,t)}else{if(u===zi)return new je(!1,!1,!1,t);if(u===$i){for(var E=!1,S=!1,D=!1,N=0;N<e.data.length;++N){var U=e.data[N];if(U.type===Hn)D=!0;else if(U.type===zn)S=!0;else if(U.type===$n)E=!0;else if(U.type===Vn){E=!0;var V=U.data;V>=1&&(S=!0),V>=2&&(D=!0)}else U.type===Qt&&(E=E||U.data.thisDep,S=S||U.data.contextDep,D=D||U.data.propDep)}return new je(E,S,D,t)}else return new je(u===$n,u===zn,u===Hn,t)}}var Eo=new je(!1,!1,!1,function(){});function vc(e,t,u,x,C,E,S,D,N,U,V,j,z,P,k){var p=U.Record,g={add:32774,subtract:32778,"reverse subtract":32779};u.ext_blend_minmax&&(g.min=lc,g.max=dc);var M=u.angle_instanced_arrays,Z=u.webgl_draw_buffers,G=u.oes_vertex_array_object,Q={dirty:!0,profile:k.profile},W={},oe=[],O={},R={};function re(a){return a.replace(".","_")}function $(a,r,c){var h=re(a);oe.push(a),W[h]=Q[h]=!!c,O[h]=r}function I(a,r,c){var h=re(a);oe.push(a),Array.isArray(c)?(Q[h]=c.slice(),W[h]=c.slice()):Q[h]=W[h]=c,R[h]=r}$(Xi,ac),$(Yi,nc),I(Wi,"blendColor",[0,0,0,0]),I(Xn,"blendEquationSeparate",[po,po]),I(Yn,"blendFuncSeparate",[ho,mo,ho,mo]),$(qi,oc,!0),I(Qi,"depthFunc",hc),I(Ki,"depthRange",[0,1]),I(Zi,"depthMask",!0),I(Wn,Wn,[!0,!0,!0,!0]),$(Ji,tc),I(eo,"cullFace",Ir),I(qn,qn,sa),I(Qn,Qn,1),$(ro,sc),I(Kn,"polygonOffset",[0,0]),$(to,uc),$(no,cc),I(Zn,"sampleCoverage",[1,!1]),$(ao,ic),I(io,"stencilMask",-1),I(Jn,"stencilFunc",[mc,0,-1]),I(ea,"stencilOpSeparate",[St,Tr,Tr,Tr]),I(pt,"stencilOpSeparate",[Ir,Tr,Tr,Tr]),$(oo,fc),I(Kt,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),I(vr,vr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var X={gl:e,context:z,strings:t,next:W,current:Q,draw:j,elements:E,buffer:C,shader:V,attributes:U.state,vao:U,uniforms:N,framebuffer:D,extensions:u,timer:P,isBufferArgs:cn},Y={primTypes:Ar,compareFuncs:it,blendFuncs:lr,blendEquations:g,stencilOps:gr,glTypes:Rr,orientationType:ua};n.optional(function(){X.isArrayLike=Re}),Z&&(Y.backBuffer=[Ir],Y.drawBuffer=er(x.maxDrawbuffers,function(a){return a===0?[0]:er(a,function(r){return pc+r})}));var me=0;function le(){var a=qu(),r=a.link,c=a.global;a.id=me++,a.batchId="0";var h=r(X),v=a.shared={props:"a0"};Object.keys(X).forEach(function(s){v[s]=c.def(h,".",s)}),n.optional(function(){a.CHECK=r(n),a.commandStr=n.guessCommand(),a.command=r(a.commandStr),a.assert=function(s,o,_){s("if(!(",o,"))",this.CHECK,".commandRaise(",r(_),",",this.command,");")},Y.invalidBlendCombinations=bo});var d=a.next={},l=a.current={};Object.keys(R).forEach(function(s){Array.isArray(Q[s])&&(d[s]=c.def(v.next,".",s),l[s]=c.def(v.current,".",s))});var m=a.constants={};Object.keys(Y).forEach(function(s){m[s]=c.def(JSON.stringify(Y[s]))}),a.invoke=function(s,o){switch(o.type){case Vn:var _=["this",v.context,v.props,a.batchId];return s.def(r(o.data),".call(",_.slice(0,Math.max(o.data.length+1,4)),")");case Hn:return s.def(v.props,o.data);case zn:return s.def(v.context,o.data);case $n:return s.def("this",o.data);case Qt:return o.data.append(a,s),o.data.ref;case zi:return o.data.toString();case $i:return o.data.map(function(b){return a.invoke(s,b)})}},a.attribCache={};var i={};return a.scopeAttrib=function(s){var o=t.id(s);if(o in i)return i[o];var _=U.scope[o];_||(_=U.scope[o]=new p);var b=i[o]=r(_);return b},a}function q(a){var r=a.static,c=a.dynamic,h;if(vt in r){var v=!!r[vt];h=De(function(l,m){return v}),h.enable=v}else if(vt in c){var d=c[vt];h=Qe(d,function(l,m){return l.invoke(m,d)})}return h}function K(a,r){var c=a.static,h=a.dynamic;if(Gr in c){var v=c[Gr];return v?(v=D.getFramebuffer(v),n.command(v,"invalid framebuffer object"),De(function(l,m){var i=l.link(v),s=l.shared;m.set(s.framebuffer,".next",i);var o=s.context;return m.set(o,"."+tt,i+".width"),m.set(o,"."+nt,i+".height"),i})):De(function(l,m){var i=l.shared;m.set(i.framebuffer,".next","null");var s=i.context;return m.set(s,"."+tt,s+"."+so),m.set(s,"."+nt,s+"."+uo),"null"})}else if(Gr in h){var d=h[Gr];return Qe(d,function(l,m){var i=l.invoke(m,d),s=l.shared,o=s.framebuffer,_=m.def(o,".getFramebuffer(",i,")");n.optional(function(){l.assert(m,"!"+i+"||"+_,"invalid framebuffer object")}),m.set(o,".next",_);var b=s.context;return m.set(b,"."+tt,_+"?"+_+".width:"+b+"."+so),m.set(b,"."+nt,_+"?"+_+".height:"+b+"."+uo),_})}else return null}function se(a,r,c){var h=a.static,v=a.dynamic;function d(i){if(i in h){var s=h[i];n.commandType(s,"object","invalid "+i,c.commandStr);var o=!0,_=s.x|0,b=s.y|0,L,B;return"width"in s?(L=s.width|0,n.command(L>=0,"invalid "+i,c.commandStr)):o=!1,"height"in s?(B=s.height|0,n.command(B>=0,"invalid "+i,c.commandStr)):o=!1,new je(!o&&r&&r.thisDep,!o&&r&&r.contextDep,!o&&r&&r.propDep,function(ie,J){var F=ie.shared.context,w=L;"width"in s||(w=J.def(F,".",tt,"-",_));var ne=B;return"height"in s||(ne=J.def(F,".",nt,"-",b)),[_,b,w,ne]})}else if(i in v){var H=v[i],ce=Qe(H,function(ie,J){var F=ie.invoke(J,H);n.optional(function(){ie.assert(J,F+"&&typeof "+F+'==="object"',"invalid "+i)});var w=ie.shared.context,ne=J.def(F,".x|0"),te=J.def(F,".y|0"),ue=J.def('"width" in ',F,"?",F,".width|0:","(",w,".",tt,"-",ne,")"),we=J.def('"height" in ',F,"?",F,".height|0:","(",w,".",nt,"-",te,")");return n.optional(function(){ie.assert(J,ue+">=0&&"+we+">=0","invalid "+i)}),[ne,te,ue,we]});return r&&(ce.thisDep=ce.thisDep||r.thisDep,ce.contextDep=ce.contextDep||r.contextDep,ce.propDep=ce.propDep||r.propDep),ce}else return r?new je(r.thisDep,r.contextDep,r.propDep,function(ie,J){var F=ie.shared.context;return[0,0,J.def(F,".",tt),J.def(F,".",nt)]}):null}var l=d(vr);if(l){var m=l;l=new je(l.thisDep,l.contextDep,l.propDep,function(i,s){var o=m.append(i,s),_=i.shared.context;return s.set(_,"."+Qu,o[2]),s.set(_,"."+Ku,o[3]),o})}return{viewport:l,scissor_box:d(Kt)}}function he(a,r){var c=a.static,h=typeof c[_t]=="string"&&typeof c[bt]=="string";if(h){if(Object.keys(r.dynamic).length>0)return null;var v=r.static,d=Object.keys(v);if(d.length>0&&typeof v[d[0]]=="number"){for(var l=[],m=0;m<d.length;++m)n(typeof v[d[m]]=="number","must specify all vertex attribute locations when using vaos"),l.push([v[d[m]]|0,d[m]]);return l}}return null}function Ee(a,r,c){var h=a.static,v=a.dynamic;function d(o){if(o in h){var _=t.id(h[o]);n.optional(function(){V.shader(_o[o],_,n.guessCommand())});var b=De(function(){return _});return b.id=_,b}else if(o in v){var L=v[o];return Qe(L,function(B,H){var ce=B.invoke(H,L),ie=H.def(B.shared.strings,".id(",ce,")");return n.optional(function(){H(B.shared.shader,".shader(",_o[o],",",ie,",",B.command,");")}),ie})}return null}var l=d(_t),m=d(bt),i=null,s;return Sr(l)&&Sr(m)?(i=V.program(m.id,l.id,null,c),s=De(function(o,_){return o.link(i)})):s=new je(l&&l.thisDep||m&&m.thisDep,l&&l.contextDep||m&&m.contextDep,l&&l.propDep||m&&m.propDep,function(o,_){var b=o.shared.shader,L;l?L=l.append(o,_):L=_.def(b,".",_t);var B;m?B=m.append(o,_):B=_.def(b,".",bt);var H=b+".program("+B+","+L;return n.optional(function(){H+=","+o.command}),_.def(H+")")}),{frag:l,vert:m,progVar:s,program:i}}function Ce(a,r){var c=a.static,h=a.dynamic,v={},d=!1;function l(){if(yt in c){var J=c[yt];return J!==null&&U.getVAO(J)===null&&(J=U.createVAO(J)),d=!0,v.vao=J,De(function(w){var ne=U.getVAO(J);return ne?w.link(ne):"null"})}else if(yt in h){d=!0;var F=h[yt];return Qe(F,function(w,ne){var te=w.invoke(ne,F);return ne.def(w.shared.vao+".getVAO("+te+")")})}return null}var m=l(),i=!1;function s(){if(Nr in c){var J=c[Nr];if(v.elements=J,cn(J)){var F=v.elements=E.create(J,!0);J=E.getElements(F),i=!0}else J&&(J=E.getElements(J),i=!0,n.command(J,"invalid elements",r.commandStr));var w=De(function(te,ue){if(J){var we=te.link(J);return te.ELEMENTS=we,we}return te.ELEMENTS=null,null});return w.value=J,w}else if(Nr in h){i=!0;var ne=h[Nr];return Qe(ne,function(te,ue){var we=te.shared,Ye=we.isBufferArgs,kr=we.elements,br=te.invoke(ue,ne),mr=ue.def("null"),wr=ue.def(Ye,"(",br,")"),Ur=te.cond(wr).then(mr,"=",kr,".createStream(",br,");").else(mr,"=",kr,".getElements(",br,");");return n.optional(function(){te.assert(Ur.else,"!"+br+"||"+mr,"invalid elements")}),ue.entry(Ur),ue.exit(te.cond(wr).then(kr,".destroyStream(",mr,");")),te.ELEMENTS=mr,mr})}else if(d)return new je(m.thisDep,m.contextDep,m.propDep,function(te,ue){return ue.def(te.shared.vao+".currentVAO?"+te.shared.elements+".getElements("+te.shared.vao+".currentVAO.elements):null")});return null}var o=s();function _(){if(Dr in c){var J=c[Dr];return v.primitive=J,n.commandParameter(J,Ar,"invalid primitve",r.commandStr),De(function(w,ne){return Ar[J]})}else if(Dr in h){var F=h[Dr];return Qe(F,function(w,ne){var te=w.constants.primTypes,ue=w.invoke(ne,F);return n.optional(function(){w.assert(ne,ue+" in "+te,"invalid primitive, must be one of "+Object.keys(Ar))}),ne.def(te,"[",ue,"]")})}else{if(i)return Sr(o)?o.value?De(function(w,ne){return ne.def(w.ELEMENTS,".primType")}):De(function(){return fa}):new je(o.thisDep,o.contextDep,o.propDep,function(w,ne){var te=w.ELEMENTS;return ne.def(te,"?",te,".primType:",fa)});if(d)return new je(m.thisDep,m.contextDep,m.propDep,function(w,ne){return ne.def(w.shared.vao+".currentVAO?"+w.shared.vao+".currentVAO.primitive:"+fa)})}return null}function b(J,F){if(J in c){var w=c[J]|0;return F?v.offset=w:v.instances=w,n.command(!F||w>=0,"invalid "+J,r.commandStr),De(function(te,ue){return F&&(te.OFFSET=w),w})}else if(J in h){var ne=h[J];return Qe(ne,function(te,ue){var we=te.invoke(ue,ne);return F&&(te.OFFSET=we,n.optional(function(){te.assert(ue,we+">=0","invalid "+J)})),we})}else if(F){if(i)return De(function(te,ue){return te.OFFSET=0,0});if(d)return new je(m.thisDep,m.contextDep,m.propDep,function(te,ue){return ue.def(te.shared.vao+".currentVAO?"+te.shared.vao+".currentVAO.offset:0")})}else if(d)return new je(m.thisDep,m.contextDep,m.propDep,function(te,ue){return ue.def(te.shared.vao+".currentVAO?"+te.shared.vao+".currentVAO.instances:-1")});return null}var L=b(Zt,!0);function B(){if(Pr in c){var J=c[Pr]|0;return v.count=J,n.command(typeof J=="number"&&J>=0,"invalid vertex count",r.commandStr),De(function(){return J})}else if(Pr in h){var F=h[Pr];return Qe(F,function(ue,we){var Ye=ue.invoke(we,F);return n.optional(function(){ue.assert(we,"typeof "+Ye+'==="number"&&'+Ye+">=0&&"+Ye+"===("+Ye+"|0)","invalid vertex count")}),Ye})}else if(i)if(Sr(o)){if(o)return L?new je(L.thisDep,L.contextDep,L.propDep,function(ue,we){var Ye=we.def(ue.ELEMENTS,".vertCount-",ue.OFFSET);return n.optional(function(){ue.assert(we,Ye+">=0","invalid vertex offset/element buffer too small")}),Ye}):De(function(ue,we){return we.def(ue.ELEMENTS,".vertCount")});var w=De(function(){return-1});return n.optional(function(){w.MISSING=!0}),w}else{var ne=new je(o.thisDep||L.thisDep,o.contextDep||L.contextDep,o.propDep||L.propDep,function(ue,we){var Ye=ue.ELEMENTS;return ue.OFFSET?we.def(Ye,"?",Ye,".vertCount-",ue.OFFSET,":-1"):we.def(Ye,"?",Ye,".vertCount:-1")});return n.optional(function(){ne.DYNAMIC=!0}),ne}else if(d){var te=new je(m.thisDep,m.contextDep,m.propDep,function(ue,we){return we.def(ue.shared.vao,".currentVAO?",ue.shared.vao,".currentVAO.count:-1")});return te}return null}var H=_(),ce=B(),ie=b(Jt,!1);return{elements:o,primitive:H,count:ce,instances:ie,offset:L,vao:m,vaoActive:d,elementsActive:i,static:v}}function Be(a,r){var c=a.static,h=a.dynamic,v={};return oe.forEach(function(d){var l=re(d);function m(i,s){if(d in c){var o=i(c[d]);v[l]=De(function(){return o})}else if(d in h){var _=h[d];v[l]=Qe(_,function(b,L){return s(b,L,b.invoke(L,_))})}}switch(d){case Ji:case Yi:case Xi:case ao:case qi:case oo:case ro:case to:case no:case Zi:return m(function(i){return n.commandType(i,"boolean",d,r.commandStr),i},function(i,s,o){return n.optional(function(){i.assert(s,"typeof "+o+'==="boolean"',"invalid flag "+d,i.commandStr)}),o});case Qi:return m(function(i){return n.commandParameter(i,it,"invalid "+d,r.commandStr),it[i]},function(i,s,o){var _=i.constants.compareFuncs;return n.optional(function(){i.assert(s,o+" in "+_,"invalid "+d+", must be one of "+Object.keys(it))}),s.def(_,"[",o,"]")});case Ki:return m(function(i){return n.command(Re(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"&&i[0]<=i[1],"depth range is 2d array",r.commandStr),i},function(i,s,o){n.optional(function(){i.assert(s,i.shared.isArrayLike+"("+o+")&&"+o+".length===2&&typeof "+o+'[0]==="number"&&typeof '+o+'[1]==="number"&&'+o+"[0]<="+o+"[1]","depth range must be a 2d array")});var _=s.def("+",o,"[0]"),b=s.def("+",o,"[1]");return[_,b]});case Yn:return m(function(i){n.commandType(i,"object","blend.func",r.commandStr);var s="srcRGB"in i?i.srcRGB:i.src,o="srcAlpha"in i?i.srcAlpha:i.src,_="dstRGB"in i?i.dstRGB:i.dst,b="dstAlpha"in i?i.dstAlpha:i.dst;return n.commandParameter(s,lr,l+".srcRGB",r.commandStr),n.commandParameter(o,lr,l+".srcAlpha",r.commandStr),n.commandParameter(_,lr,l+".dstRGB",r.commandStr),n.commandParameter(b,lr,l+".dstAlpha",r.commandStr),n.command(bo.indexOf(s+", "+_)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+s+", "+_+")",r.commandStr),[lr[s],lr[_],lr[o],lr[b]]},function(i,s,o){var _=i.constants.blendFuncs;n.optional(function(){i.assert(s,o+"&&typeof "+o+'==="object"',"invalid blend func, must be an object")});function b(F,w){var ne=s.def('"',F,w,'" in ',o,"?",o,".",F,w,":",o,".",F);return n.optional(function(){i.assert(s,ne+" in "+_,"invalid "+d+"."+F+w+", must be one of "+Object.keys(lr))}),ne}var L=b("src","RGB"),B=b("dst","RGB");n.optional(function(){var F=i.constants.invalidBlendCombinations;i.assert(s,F+".indexOf("+L+'+", "+'+B+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var H=s.def(_,"[",L,"]"),ce=s.def(_,"[",b("src","Alpha"),"]"),ie=s.def(_,"[",B,"]"),J=s.def(_,"[",b("dst","Alpha"),"]");return[H,ie,ce,J]});case Xn:return m(function(i){if(typeof i=="string")return n.commandParameter(i,g,"invalid "+d,r.commandStr),[g[i],g[i]];if(typeof i=="object")return n.commandParameter(i.rgb,g,d+".rgb",r.commandStr),n.commandParameter(i.alpha,g,d+".alpha",r.commandStr),[g[i.rgb],g[i.alpha]];n.commandRaise("invalid blend.equation",r.commandStr)},function(i,s,o){var _=i.constants.blendEquations,b=s.def(),L=s.def(),B=i.cond("typeof ",o,'==="string"');return n.optional(function(){function H(ce,ie,J){i.assert(ce,J+" in "+_,"invalid "+ie+", must be one of "+Object.keys(g))}H(B.then,d,o),i.assert(B.else,o+"&&typeof "+o+'==="object"',"invalid "+d),H(B.else,d+".rgb",o+".rgb"),H(B.else,d+".alpha",o+".alpha")}),B.then(b,"=",L,"=",_,"[",o,"];"),B.else(b,"=",_,"[",o,".rgb];",L,"=",_,"[",o,".alpha];"),s(B),[b,L]});case Wi:return m(function(i){return n.command(Re(i)&&i.length===4,"blend.color must be a 4d array",r.commandStr),er(4,function(s){return+i[s]})},function(i,s,o){return n.optional(function(){i.assert(s,i.shared.isArrayLike+"("+o+")&&"+o+".length===4","blend.color must be a 4d array")}),er(4,function(_){return s.def("+",o,"[",_,"]")})});case io:return m(function(i){return n.commandType(i,"number",l,r.commandStr),i|0},function(i,s,o){return n.optional(function(){i.assert(s,"typeof "+o+'==="number"',"invalid stencil.mask")}),s.def(o,"|0")});case Jn:return m(function(i){n.commandType(i,"object",l,r.commandStr);var s=i.cmp||"keep",o=i.ref||0,_="mask"in i?i.mask:-1;return n.commandParameter(s,it,d+".cmp",r.commandStr),n.commandType(o,"number",d+".ref",r.commandStr),n.commandType(_,"number",d+".mask",r.commandStr),[it[s],o,_]},function(i,s,o){var _=i.constants.compareFuncs;n.optional(function(){function H(){i.assert(s,Array.prototype.join.call(arguments,""),"invalid stencil.func")}H(o+"&&typeof ",o,'==="object"'),H('!("cmp" in ',o,")||(",o,".cmp in ",_,")")});var b=s.def('"cmp" in ',o,"?",_,"[",o,".cmp]",":",Tr),L=s.def(o,".ref|0"),B=s.def('"mask" in ',o,"?",o,".mask|0:-1");return[b,L,B]});case ea:case pt:return m(function(i){n.commandType(i,"object",l,r.commandStr);var s=i.fail||"keep",o=i.zfail||"keep",_=i.zpass||"keep";return n.commandParameter(s,gr,d+".fail",r.commandStr),n.commandParameter(o,gr,d+".zfail",r.commandStr),n.commandParameter(_,gr,d+".zpass",r.commandStr),[d===pt?Ir:St,gr[s],gr[o],gr[_]]},function(i,s,o){var _=i.constants.stencilOps;n.optional(function(){i.assert(s,o+"&&typeof "+o+'==="object"',"invalid "+d)});function b(L){return n.optional(function(){i.assert(s,'!("'+L+'" in '+o+")||("+o+"."+L+" in "+_+")","invalid "+d+"."+L+", must be one of "+Object.keys(gr))}),s.def('"',L,'" in ',o,"?",_,"[",o,".",L,"]:",Tr)}return[d===pt?Ir:St,b("fail"),b("zfail"),b("zpass")]});case Kn:return m(function(i){n.commandType(i,"object",l,r.commandStr);var s=i.factor|0,o=i.units|0;return n.commandType(s,"number",l+".factor",r.commandStr),n.commandType(o,"number",l+".units",r.commandStr),[s,o]},function(i,s,o){n.optional(function(){i.assert(s,o+"&&typeof "+o+'==="object"',"invalid "+d)});var _=s.def(o,".factor|0"),b=s.def(o,".units|0");return[_,b]});case eo:return m(function(i){var s=0;return i==="front"?s=St:i==="back"&&(s=Ir),n.command(!!s,l,r.commandStr),s},function(i,s,o){return n.optional(function(){i.assert(s,o+'==="front"||'+o+'==="back"',"invalid cull.face")}),s.def(o,'==="front"?',St,":",Ir)});case Qn:return m(function(i){return n.command(typeof i=="number"&&i>=x.lineWidthDims[0]&&i<=x.lineWidthDims[1],"invalid line width, must be a positive number between "+x.lineWidthDims[0]+" and "+x.lineWidthDims[1],r.commandStr),i},function(i,s,o){return n.optional(function(){i.assert(s,"typeof "+o+'==="number"&&'+o+">="+x.lineWidthDims[0]+"&&"+o+"<="+x.lineWidthDims[1],"invalid line width")}),o});case qn:return m(function(i){return n.commandParameter(i,ua,l,r.commandStr),ua[i]},function(i,s,o){return n.optional(function(){i.assert(s,o+'==="cw"||'+o+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),s.def(o+'==="cw"?'+lo+":"+sa)});case Wn:return m(function(i){return n.command(Re(i)&&i.length===4,"color.mask must be length 4 array",r.commandStr),i.map(function(s){return!!s})},function(i,s,o){return n.optional(function(){i.assert(s,i.shared.isArrayLike+"("+o+")&&"+o+".length===4","invalid color.mask")}),er(4,function(_){return"!!"+o+"["+_+"]"})});case Zn:return m(function(i){n.command(typeof i=="object"&&i,l,r.commandStr);var s="value"in i?i.value:1,o=!!i.invert;return n.command(typeof s=="number"&&s>=0&&s<=1,"sample.coverage.value must be a number between 0 and 1",r.commandStr),[s,o]},function(i,s,o){n.optional(function(){i.assert(s,o+"&&typeof "+o+'==="object"',"invalid sample.coverage")});var _=s.def('"value" in ',o,"?+",o,".value:1"),b=s.def("!!",o,".invert");return[_,b]})}}),v}function xe(a,r){var c=a.static,h=a.dynamic,v={};return Object.keys(c).forEach(function(d){var l=c[d],m;if(typeof l=="number"||typeof l=="boolean")m=De(function(){return l});else if(typeof l=="function"){var i=l._reglType;i==="texture2d"||i==="textureCube"?m=De(function(s){return s.link(l)}):i==="framebuffer"||i==="framebufferCube"?(n.command(l.color.length>0,'missing color attachment for framebuffer sent to uniform "'+d+'"',r.commandStr),m=De(function(s){return s.link(l.color[0])})):n.commandRaise('invalid data for uniform "'+d+'"',r.commandStr)}else Re(l)?m=De(function(s){var o=s.global.def("[",er(l.length,function(_){return n.command(typeof l[_]=="number"||typeof l[_]=="boolean","invalid uniform "+d,s.commandStr),l[_]}),"]");return o}):n.commandRaise('invalid or missing data for uniform "'+d+'"',r.commandStr);m.value=l,v[d]=m}),Object.keys(h).forEach(function(d){var l=h[d];v[d]=Qe(l,function(m,i){return m.invoke(i,l)})}),v}function Me(a,r){var c=a.static,h=a.dynamic,v={};return Object.keys(c).forEach(function(d){var l=c[d],m=t.id(d),i=new p;if(cn(l))i.state=rt,i.buffer=C.getBuffer(C.create(l,at,!1,!0)),i.type=0;else{var s=C.getBuffer(l);if(s)i.state=rt,i.buffer=s,i.type=0;else if(n.command(typeof l=="object"&&l,"invalid data for attribute "+d,r.commandStr),"constant"in l){var o=l.constant;i.buffer="null",i.state=jn,typeof o=="number"?i.x=o:(n.command(Re(o)&&o.length>0&&o.length<=4,"invalid constant for attribute "+d,r.commandStr),et.forEach(function(ie,J){J<o.length&&(i[ie]=o[J])}))}else{cn(l.buffer)?s=C.getBuffer(C.create(l.buffer,at,!1,!0)):s=C.getBuffer(l.buffer),n.command(!!s,'missing buffer for attribute "'+d+'"',r.commandStr);var _=l.offset|0;n.command(_>=0,'invalid offset for attribute "'+d+'"',r.commandStr);var b=l.stride|0;n.command(b>=0&&b<256,'invalid stride for attribute "'+d+'", must be integer betweeen [0, 255]',r.commandStr);var L=l.size|0;n.command(!("size"in l)||L>0&&L<=4,'invalid size for attribute "'+d+'", must be 1,2,3,4',r.commandStr);var B=!!l.normalized,H=0;"type"in l&&(n.commandParameter(l.type,Rr,"invalid type for attribute "+d,r.commandStr),H=Rr[l.type]);var ce=l.divisor|0;n.optional(function(){"divisor"in l&&(n.command(ce===0||M,'cannot specify divisor for attribute "'+d+'", instancing not supported',r.commandStr),n.command(ce>=0,'invalid divisor for attribute "'+d+'"',r.commandStr));var ie=r.commandStr,J=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(l).forEach(function(F){n.command(J.indexOf(F)>=0,'unknown parameter "'+F+'" for attribute pointer "'+d+'" (valid parameters are '+J+")",ie)})}),i.buffer=s,i.state=rt,i.size=L,i.normalized=B,i.type=H||s.dtype,i.offset=_,i.stride=b,i.divisor=ce}}v[d]=De(function(ie,J){var F=ie.attribCache;if(m in F)return F[m];var w={isStream:!1};return Object.keys(i).forEach(function(ne){w[ne]=i[ne]}),i.buffer&&(w.buffer=ie.link(i.buffer),w.type=w.type||w.buffer+".dtype"),F[m]=w,w})}),Object.keys(h).forEach(function(d){var l=h[d];function m(i,s){var o=i.invoke(s,l),_=i.shared,b=i.constants,L=_.isBufferArgs,B=_.buffer;n.optional(function(){i.assert(s,o+"&&(typeof "+o+'==="object"||typeof '+o+'==="function")&&('+L+"("+o+")||"+B+".getBuffer("+o+")||"+B+".getBuffer("+o+".buffer)||"+L+"("+o+'.buffer)||("constant" in '+o+"&&(typeof "+o+'.constant==="number"||'+_.isArrayLike+"("+o+".constant))))",'invalid dynamic attribute "'+d+'"')});var H={isStream:s.def(!1)},ce=new p;ce.state=rt,Object.keys(ce).forEach(function(w){H[w]=s.def(""+ce[w])});var ie=H.buffer,J=H.type;s("if(",L,"(",o,")){",H.isStream,"=true;",ie,"=",B,".createStream(",at,",",o,");",J,"=",ie,".dtype;","}else{",ie,"=",B,".getBuffer(",o,");","if(",ie,"){",J,"=",ie,".dtype;",'}else if("constant" in ',o,"){",H.state,"=",jn,";","if(typeof "+o+'.constant === "number"){',H[et[0]],"=",o,".constant;",et.slice(1).map(function(w){return H[w]}).join("="),"=0;","}else{",et.map(function(w,ne){return H[w]+"="+o+".constant.length>"+ne+"?"+o+".constant["+ne+"]:0;"}).join(""),"}}else{","if(",L,"(",o,".buffer)){",ie,"=",B,".createStream(",at,",",o,".buffer);","}else{",ie,"=",B,".getBuffer(",o,".buffer);","}",J,'="type" in ',o,"?",b.glTypes,"[",o,".type]:",ie,".dtype;",H.normalized,"=!!",o,".normalized;");function F(w){s(H[w],"=",o,".",w,"|0;")}return F("size"),F("offset"),F("stride"),F("divisor"),s("}}"),s.exit("if(",H.isStream,"){",B,".destroyStream(",ie,");","}"),H}v[d]=Qe(l,m)}),v}function Le(a){var r=a.static,c=a.dynamic,h={};return Object.keys(r).forEach(function(v){var d=r[v];h[v]=De(function(l,m){return typeof d=="number"||typeof d=="boolean"?""+d:l.link(d)})}),Object.keys(c).forEach(function(v){var d=c[v];h[v]=Qe(d,function(l,m){return l.invoke(m,d)})}),h}function Pe(a,r,c,h,v){var d=a.static,l=a.dynamic;n.optional(function(){var F=[Gr,bt,_t,Nr,Dr,Zt,Pr,Jt,vt,yt].concat(oe);function w(ne){Object.keys(ne).forEach(function(te){n.command(F.indexOf(te)>=0,'unknown parameter "'+te+'"',v.commandStr)})}w(d),w(l)});var m=he(a,r),i=K(a),s=se(a,i,v),o=Ce(a,v),_=Be(a,v),b=Ee(a,v,m);function L(F){var w=s[F];w&&(_[F]=w)}L(vr),L(re(Kt));var B=Object.keys(_).length>0,H={framebuffer:i,draw:o,shader:b,state:_,dirty:B,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(H.profile=q(a),H.uniforms=xe(c,v),H.drawVAO=H.scopeVAO=o.vao,!H.drawVAO&&b.program&&!m&&u.angle_instanced_arrays&&o.static.elements){var ce=!0,ie=b.program.attributes.map(function(F){var w=r.static[F];return ce=ce&&!!w,w});if(ce&&ie.length>0){var J=U.getVAO(U.createVAO({attributes:ie,elements:o.static.elements}));H.drawVAO=new je(null,null,null,function(F,w){return F.link(J)}),H.useVAO=!0}}return m?H.useVAO=!0:H.attributes=Me(r,v),H.context=Le(h),H}function ke(a,r,c){var h=a.shared,v=h.context,d=a.scope();Object.keys(c).forEach(function(l){r.save(v,"."+l);var m=c[l],i=m.append(a,r);Array.isArray(i)?d(v,".",l,"=[",i.join(),"];"):d(v,".",l,"=",i,";")}),r(d)}function Ue(a,r,c,h){var v=a.shared,d=v.gl,l=v.framebuffer,m;Z&&(m=r.def(v.extensions,".webgl_draw_buffers"));var i=a.constants,s=i.drawBuffer,o=i.backBuffer,_;c?_=c.append(a,r):_=r.def(l,".next"),h||r("if(",_,"!==",l,".cur){"),r("if(",_,"){",d,".bindFramebuffer(",vo,",",_,".framebuffer);"),Z&&r(m,".drawBuffersWEBGL(",s,"[",_,".colorAttachments.length]);"),r("}else{",d,".bindFramebuffer(",vo,",null);"),Z&&r(m,".drawBuffersWEBGL(",o,");"),r("}",l,".cur=",_,";"),h||r("}")}function He(a,r,c){var h=a.shared,v=h.gl,d=a.current,l=a.next,m=h.current,i=h.next,s=a.cond(m,".dirty");oe.forEach(function(o){var _=re(o);if(!(_ in c.state)){var b,L;if(_ in l){b=l[_],L=d[_];var B=er(Q[_].length,function(ce){return s.def(b,"[",ce,"]")});s(a.cond(B.map(function(ce,ie){return ce+"!=="+L+"["+ie+"]"}).join("||")).then(v,".",R[_],"(",B,");",B.map(function(ce,ie){return L+"["+ie+"]="+ce}).join(";"),";"))}else{b=s.def(i,".",_);var H=a.cond(b,"!==",m,".",_);s(H),_ in O?H(a.cond(b).then(v,".enable(",O[_],");").else(v,".disable(",O[_],");"),m,".",_,"=",b,";"):H(v,".",R[_],"(",b,");",m,".",_,"=",b,";")}}}),Object.keys(c.state).length===0&&s(m,".dirty=false;"),r(s)}function $e(a,r,c,h){var v=a.shared,d=a.current,l=v.current,m=v.gl;yo(Object.keys(c)).forEach(function(i){var s=c[i];if(!(h&&!h(s))){var o=s.append(a,r);if(O[i]){var _=O[i];Sr(s)?o?r(m,".enable(",_,");"):r(m,".disable(",_,");"):r(a.cond(o).then(m,".enable(",_,");").else(m,".disable(",_,");")),r(l,".",i,"=",o,";")}else if(Re(o)){var b=d[i];r(m,".",R[i],"(",o,");",o.map(function(L,B){return b+"["+B+"]="+L}).join(";"),";")}else r(m,".",R[i],"(",o,");",l,".",i,"=",o,";")}})}function Fe(a,r){M&&(a.instancing=r.def(a.shared.extensions,".angle_instanced_arrays"))}function be(a,r,c,h,v){var d=a.shared,l=a.stats,m=d.current,i=d.timer,s=c.profile;function o(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var _,b;function L(F){_=r.def(),F(_,"=",o(),";"),typeof v=="string"?F(l,".count+=",v,";"):F(l,".count++;"),P&&(h?(b=r.def(),F(b,"=",i,".getNumPendingQueries();")):F(i,".beginQuery(",l,");"))}function B(F){F(l,".cpuTime+=",o(),"-",_,";"),P&&(h?F(i,".pushScopeStats(",b,",",i,".getNumPendingQueries(),",l,");"):F(i,".endQuery();"))}function H(F){var w=r.def(m,".profile");r(m,".profile=",F,";"),r.exit(m,".profile=",w,";")}var ce;if(s){if(Sr(s)){s.enable?(L(r),B(r.exit),H("true")):H("false");return}ce=s.append(a,r),H(ce)}else ce=r.def(m,".profile");var ie=a.block();L(ie),r("if(",ce,"){",ie,"}");var J=a.block();B(J),r.exit("if(",ce,"){",J,"}")}function Xe(a,r,c,h,v){var d=a.shared;function l(i){switch(i){case en:case nn:case fn:return 2;case rn:case an:case sn:return 3;case tn:case on:case un:return 4;default:return 1}}function m(i,s,o){var _=d.gl,b=r.def(i,".location"),L=r.def(d.attributes,"[",b,"]"),B=o.state,H=o.buffer,ce=[o.x,o.y,o.z,o.w],ie=["buffer","normalized","offset","stride"];function J(){r("if(!",L,".buffer){",_,".enableVertexAttribArray(",b,");}");var w=o.type,ne;if(o.size?ne=r.def(o.size,"||",s):ne=s,r("if(",L,".type!==",w,"||",L,".size!==",ne,"||",ie.map(function(ue){return L+"."+ue+"!=="+o[ue]}).join("||"),"){",_,".bindBuffer(",at,",",H,".buffer);",_,".vertexAttribPointer(",[b,ne,w,o.normalized,o.stride,o.offset],");",L,".type=",w,";",L,".size=",ne,";",ie.map(function(ue){return L+"."+ue+"="+o[ue]+";"}).join(""),"}"),M){var te=o.divisor;r("if(",L,".divisor!==",te,"){",a.instancing,".vertexAttribDivisorANGLE(",[b,te],");",L,".divisor=",te,";}")}}function F(){r("if(",L,".buffer){",_,".disableVertexAttribArray(",b,");",L,".buffer=null;","}if(",et.map(function(w,ne){return L+"."+w+"!=="+ce[ne]}).join("||"),"){",_,".vertexAttrib4f(",b,",",ce,");",et.map(function(w,ne){return L+"."+w+"="+ce[ne]+";"}).join(""),"}")}B===rt?J():B===jn?F():(r("if(",B,"===",rt,"){"),J(),r("}else{"),F(),r("}"))}h.forEach(function(i){var s=i.name,o=c.attributes[s],_;if(o){if(!v(o))return;_=o.append(a,r)}else{if(!v(Eo))return;var b=a.scopeAttrib(s);n.optional(function(){a.assert(r,b+".state","missing attribute "+s)}),_={},Object.keys(new p).forEach(function(L){_[L]=r.def(b,".",L)})}m(a.link(i),l(i.info.type),_)})}function Se(a,r,c,h,v,d){for(var l=a.shared,m=l.gl,i={},s,o=0;o<h.length;++o){var _=h[o],b=_.name,L=_.info.type,B=_.info.size,H=c.uniforms[b];if(B>1){if(!H)continue;var ce=b.replace("[0]","");if(i[ce])continue;i[ce]=1}var ie=a.link(_),J=ie+".location",F;if(H){if(!v(H))continue;if(Sr(H)){var w=H.value;if(n.command(w!==null&&typeof w!="undefined",'missing uniform "'+b+'"',a.commandStr),L===Tt||L===gt){n.command(typeof w=="function"&&(L===Tt&&(w._reglType==="texture2d"||w._reglType==="framebuffer")||L===gt&&(w._reglType==="textureCube"||w._reglType==="framebufferCube")),"invalid texture for uniform "+b,a.commandStr);var ne=a.link(w._texture||w.color[0]._texture);r(m,".uniform1i(",J,",",ne+".bind());"),r.exit(ne,".unbind();")}else if(L===Et||L===At||L===xt){n.optional(function(){n.command(Re(w),"invalid matrix for uniform "+b,a.commandStr),n.command(L===Et&&w.length===4||L===At&&w.length===9||L===xt&&w.length===16,"invalid length for matrix uniform "+b,a.commandStr)});var te=a.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),ue=2;L===At?ue=3:L===xt&&(ue=4),r(m,".uniformMatrix",ue,"fv(",J,",false,",te,");")}else{switch(L){case aa:B===1?n.commandType(w,"number","uniform "+b,a.commandStr):n.command(Re(w)&&w.length===B,"uniform "+b,a.commandStr),s="1f";break;case en:n.command(Re(w)&&w.length&&w.length%2==0&&w.length<=B*2,"uniform "+b,a.commandStr),s="2f";break;case rn:n.command(Re(w)&&w.length&&w.length%3==0&&w.length<=B*3,"uniform "+b,a.commandStr),s="3f";break;case tn:n.command(Re(w)&&w.length&&w.length%4==0&&w.length<=B*4,"uniform "+b,a.commandStr),s="4f";break;case oa:B===1?n.commandType(w,"boolean","uniform "+b,a.commandStr):n.command(Re(w)&&w.length===B,"uniform "+b,a.commandStr),s="1i";break;case ia:B===1?n.commandType(w,"number","uniform "+b,a.commandStr):n.command(Re(w)&&w.length===B,"uniform "+b,a.commandStr),s="1i";break;case fn:n.command(Re(w)&&w.length&&w.length%2==0&&w.length<=B*2,"uniform "+b,a.commandStr),s="2i";break;case nn:n.command(Re(w)&&w.length&&w.length%2==0&&w.length<=B*2,"uniform "+b,a.commandStr),s="2i";break;case sn:n.command(Re(w)&&w.length&&w.length%3==0&&w.length<=B*3,"uniform "+b,a.commandStr),s="3i";break;case an:n.command(Re(w)&&w.length&&w.length%3==0&&w.length<=B*3,"uniform "+b,a.commandStr),s="3i";break;case un:n.command(Re(w)&&w.length&&w.length%4==0&&w.length<=B*4,"uniform "+b,a.commandStr),s="4i";break;case on:n.command(Re(w)&&w.length&&w.length%4==0&&w.length<=B*4,"uniform "+b,a.commandStr),s="4i";break}B>1?(s+="v",w=a.global.def("["+Array.prototype.slice.call(w)+"]")):w=Re(w)?Array.prototype.slice.call(w):w,r(m,".uniform",s,"(",J,",",w,");")}continue}else F=H.append(a,r)}else{if(!v(Eo))continue;F=r.def(l.uniforms,"[",t.id(b),"]")}L===Tt?(n(!Array.isArray(F),"must specify a scalar prop for textures"),r("if(",F,"&&",F,'._reglType==="framebuffer"){',F,"=",F,".color[0];","}")):L===gt&&(n(!Array.isArray(F),"must specify a scalar prop for cube maps"),r("if(",F,"&&",F,'._reglType==="framebufferCube"){',F,"=",F,".color[0];","}")),n.optional(function(){function tr(Ke,ln){a.assert(r,Ke,'bad data or missing for uniform "'+b+'".  '+ln)}function jr(Ke,ln){ln===1&&n(!Array.isArray(F),"must not specify an array type for uniform"),tr("Array.isArray("+F+") && typeof "+F+'[0]===" '+Ke+'" || typeof '+F+'==="'+Ke+'"',"invalid type, expected "+Ke)}function ar(Ke,ln,dn){Array.isArray(F)?n(F.length&&F.length%Ke==0&&F.length<=Ke*dn,"must have length of "+(dn===1?"":"n * ")+Ke):tr(l.isArrayLike+"("+F+")&&"+F+".length && "+F+".length % "+Ke+" === 0 && "+F+".length<="+Ke*dn,"invalid vector, should have length of "+(dn===1?"":"n * ")+Ke,a.commandStr)}function Lo(Ke){n(!Array.isArray(F),"must not specify a value type"),tr("typeof "+F+'==="function"&&'+F+'._reglType==="texture'+(Ke===co?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(L){case ia:jr("number",B);break;case nn:ar(2,"number",B);break;case an:ar(3,"number",B);break;case on:ar(4,"number",B);break;case aa:jr("number",B);break;case en:ar(2,"number",B);break;case rn:ar(3,"number",B);break;case tn:ar(4,"number",B);break;case oa:jr("boolean",B);break;case fn:ar(2,"boolean",B);break;case sn:ar(3,"boolean",B);break;case un:ar(4,"boolean",B);break;case Et:ar(4,"number",B);break;case At:ar(9,"number",B);break;case xt:ar(16,"number",B);break;case Tt:Lo(co);break;case gt:Lo(rc);break}});var we=1;switch(L){case Tt:case gt:var Ye=r.def(F,"._texture");r(m,".uniform1i(",J,",",Ye,".bind());"),r.exit(Ye,".unbind();");continue;case ia:case oa:s="1i";break;case nn:case fn:s="2i",we=2;break;case an:case sn:s="3i",we=3;break;case on:case un:s="4i",we=4;break;case aa:s="1f";break;case en:s="2f",we=2;break;case rn:s="3f",we=3;break;case tn:s="4f",we=4;break;case Et:s="Matrix2fv";break;case At:s="Matrix3fv";break;case xt:s="Matrix4fv";break}if(s.indexOf("Matrix")===-1&&B>1&&(s+="v",we=1),s.charAt(0)==="M"){r(m,".uniform",s,"(",J,",");var kr=Math.pow(L-Et+2,2),br=a.global.def("new Float32Array(",kr,")");Array.isArray(F)?r("false,(",er(kr,function(tr){return br+"["+tr+"]="+F[tr]}),",",br,")"):r("false,(Array.isArray(",F,")||",F," instanceof Float32Array)?",F,":(",er(kr,function(tr){return br+"["+tr+"]="+F+"["+tr+"]"}),",",br,")"),r(");")}else if(we>1){for(var mr=[],wr=[],Ur=0;Ur<we;++Ur)Array.isArray(F)?wr.push(F[Ur]):wr.push(r.def(F+"["+Ur+"]")),d&&mr.push(r.def());d&&r("if(!",a.batchId,"||",mr.map(function(tr,jr){return tr+"!=="+wr[jr]}).join("||"),"){",mr.map(function(tr,jr){return tr+"="+wr[jr]+";"}).join("")),r(m,".uniform",s,"(",J,",",wr.join(","),");"),d&&r("}")}else{if(n(!Array.isArray(F),"uniform value must not be an array"),d){var wo=r.def();r("if(!",a.batchId,"||",wo,"!==",F,"){",wo,"=",F,";")}r(m,".uniform",s,"(",J,",",F,");"),d&&r("}")}}}function fe(a,r,c,h){var v=a.shared,d=v.gl,l=v.draw,m=h.draw;function i(){var ne=m.elements,te,ue=r;return ne?((ne.contextDep&&h.contextDynamic||ne.propDep)&&(ue=c),te=ne.append(a,ue),m.elementsActive&&ue("if("+te+")"+d+".bindBuffer("+na+","+te+".buffer.buffer);")):(te=ue.def(),ue(te,"=",l,".",Nr,";","if(",te,"){",d,".bindBuffer(",na,",",te,".buffer.buffer);}","else if(",v.vao,".currentVAO){",te,"=",a.shared.elements+".getElements("+v.vao,".currentVAO.elements);",G?"":"if("+te+")"+d+".bindBuffer("+na+","+te+".buffer.buffer);","}")),te}function s(){var ne=m.count,te,ue=r;return ne?((ne.contextDep&&h.contextDynamic||ne.propDep)&&(ue=c),te=ne.append(a,ue),n.optional(function(){ne.MISSING&&a.assert(r,"false","missing vertex count"),ne.DYNAMIC&&a.assert(ue,te+">=0","missing vertex count")})):(te=ue.def(l,".",Pr),n.optional(function(){a.assert(ue,te+">=0","missing vertex count")})),te}var o=i();function _(ne){var te=m[ne];return te?te.contextDep&&h.contextDynamic||te.propDep?te.append(a,c):te.append(a,r):r.def(l,".",ne)}var b=_(Dr),L=_(Zt),B=s();if(typeof B=="number"){if(B===0)return}else c("if(",B,"){"),c.exit("}");var H,ce;M&&(H=_(Jt),ce=a.instancing);var ie=o+".type",J=m.elements&&Sr(m.elements)&&!m.vaoActive;function F(){function ne(){c(ce,".drawElementsInstancedANGLE(",[b,B,ie,L+"<<(("+ie+"-"+Hi+")>>1)",H],");")}function te(){c(ce,".drawArraysInstancedANGLE(",[b,L,B,H],");")}o&&o!=="null"?J?ne():(c("if(",o,"){"),ne(),c("}else{"),te(),c("}")):te()}function w(){function ne(){c(d+".drawElements("+[b,B,ie,L+"<<(("+ie+"-"+Hi+")>>1)"]+");")}function te(){c(d+".drawArrays("+[b,L,B]+");")}o&&o!=="null"?J?ne():(c("if(",o,"){"),ne(),c("}else{"),te(),c("}")):te()}M&&(typeof H!="number"||H>=0)?typeof H=="string"?(c("if(",H,">0){"),F(),c("}else if(",H,"<0){"),w(),c("}")):F():w()}function Ae(a,r,c,h,v){var d=le(),l=d.proc("body",v);return n.optional(function(){d.commandStr=r.commandStr,d.command=d.link(r.commandStr)}),M&&(d.instancing=l.def(d.shared.extensions,".angle_instanced_arrays")),a(d,l,c,h),d.compile().body}function ge(a,r,c,h){Fe(a,r),c.useVAO?c.drawVAO?r(a.shared.vao,".setVAO(",c.drawVAO.append(a,r),");"):r(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(r(a.shared.vao,".setVAO(null);"),Xe(a,r,c,h.attributes,function(){return!0})),Se(a,r,c,h.uniforms,function(){return!0},!1),fe(a,r,r,c)}function Ge(a,r){var c=a.proc("draw",1);Fe(a,c),ke(a,c,r.context),Ue(a,c,r.framebuffer),He(a,c,r),$e(a,c,r.state),be(a,c,r,!1,!0);var h=r.shader.progVar.append(a,c);if(c(a.shared.gl,".useProgram(",h,".program);"),r.shader.program)ge(a,c,r,r.shader.program);else{c(a.shared.vao,".setVAO(null);");var v=a.global.def("{}"),d=c.def(h,".id"),l=c.def(v,"[",d,"]");c(a.cond(l).then(l,".call(this,a0);").else(l,"=",v,"[",d,"]=",a.link(function(m){return Ae(ge,a,r,m,1)}),"(",h,");",l,".call(this,a0);"))}Object.keys(r.state).length>0&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function dr(a,r,c,h){a.batchId="a1",Fe(a,r);function v(){return!0}Xe(a,r,c,h.attributes,v),Se(a,r,c,h.uniforms,v,!1),fe(a,r,r,c)}function Mr(a,r,c,h){Fe(a,r);var v=c.contextDep,d=r.def(),l="a0",m="a1",i=r.def();a.shared.props=i,a.batchId=d;var s=a.scope(),o=a.scope();r(s.entry,"for(",d,"=0;",d,"<",m,";++",d,"){",i,"=",l,"[",d,"];",o,"}",s.exit);function _(ie){return ie.contextDep&&v||ie.propDep}function b(ie){return!_(ie)}if(c.needsContext&&ke(a,o,c.context),c.needsFramebuffer&&Ue(a,o,c.framebuffer),$e(a,o,c.state,_),c.profile&&_(c.profile)&&be(a,o,c,!1,!0),h)c.useVAO?c.drawVAO?_(c.drawVAO)?o(a.shared.vao,".setVAO(",c.drawVAO.append(a,o),");"):s(a.shared.vao,".setVAO(",c.drawVAO.append(a,s),");"):s(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(s(a.shared.vao,".setVAO(null);"),Xe(a,s,c,h.attributes,b),Xe(a,o,c,h.attributes,_)),Se(a,s,c,h.uniforms,b,!1),Se(a,o,c,h.uniforms,_,!0),fe(a,s,o,c);else{var L=a.global.def("{}"),B=c.shader.progVar.append(a,o),H=o.def(B,".id"),ce=o.def(L,"[",H,"]");o(a.shared.gl,".useProgram(",B,".program);","if(!",ce,"){",ce,"=",L,"[",H,"]=",a.link(function(ie){return Ae(dr,a,c,ie,2)}),"(",B,");}",ce,".call(this,a0[",d,"],",d,");")}}function f(a,r){var c=a.proc("batch",2);a.batchId="0",Fe(a,c);var h=!1,v=!0;Object.keys(r.context).forEach(function(L){h=h||r.context[L].propDep}),h||(ke(a,c,r.context),v=!1);var d=r.framebuffer,l=!1;d?(d.propDep?h=l=!0:d.contextDep&&h&&(l=!0),l||Ue(a,c,d)):Ue(a,c,null),r.state.viewport&&r.state.viewport.propDep&&(h=!0);function m(L){return L.contextDep&&h||L.propDep}He(a,c,r),$e(a,c,r.state,function(L){return!m(L)}),(!r.profile||!m(r.profile))&&be(a,c,r,!1,"a1"),r.contextDep=h,r.needsContext=v,r.needsFramebuffer=l;var i=r.shader.progVar;if(i.contextDep&&h||i.propDep)Mr(a,c,r,null);else{var s=i.append(a,c);if(c(a.shared.gl,".useProgram(",s,".program);"),r.shader.program)Mr(a,c,r,r.shader.program);else{c(a.shared.vao,".setVAO(null);");var o=a.global.def("{}"),_=c.def(s,".id"),b=c.def(o,"[",_,"]");c(a.cond(b).then(b,".call(this,a0,a1);").else(b,"=",o,"[",_,"]=",a.link(function(L){return Ae(Mr,a,r,L,2)}),"(",s,");",b,".call(this,a0,a1);"))}}Object.keys(r.state).length>0&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function T(a,r){var c=a.proc("scope",3);a.batchId="a2";var h=a.shared,v=h.current;ke(a,c,r.context),r.framebuffer&&r.framebuffer.append(a,c),yo(Object.keys(r.state)).forEach(function(l){var m=r.state[l],i=m.append(a,c);Re(i)?i.forEach(function(s,o){c.set(a.next[l],"["+o+"]",s)}):c.set(h.next,"."+l,i)}),be(a,c,r,!0,!0),[Nr,Zt,Pr,Jt,Dr].forEach(function(l){var m=r.draw[l];!m||c.set(h.draw,"."+l,""+m.append(a,c))}),Object.keys(r.uniforms).forEach(function(l){var m=r.uniforms[l].append(a,c);Array.isArray(m)&&(m="["+m.join()+"]"),c.set(h.uniforms,"["+t.id(l)+"]",m)}),Object.keys(r.attributes).forEach(function(l){var m=r.attributes[l].append(a,c),i=a.scopeAttrib(l);Object.keys(new p).forEach(function(s){c.set(i,"."+s,m[s])})}),r.scopeVAO&&c.set(h.vao,".targetVAO",r.scopeVAO.append(a,c));function d(l){var m=r.shader[l];m&&c.set(h.shader,"."+l,m.append(a,c))}d(bt),d(_t),Object.keys(r.state).length>0&&(c(v,".dirty=true;"),c.exit(v,".dirty=true;")),c("a1(",a.shared.context,",a0,",a.batchId,");")}function y(a){if(!(typeof a!="object"||Re(a))){for(var r=Object.keys(a),c=0;c<r.length;++c)if(Je.isDynamic(a[r[c]]))return!0;return!1}}function ee(a,r,c){var h=r.static[c];if(!h||!y(h))return;var v=a.global,d=Object.keys(h),l=!1,m=!1,i=!1,s=a.global.def("{}");d.forEach(function(_){var b=h[_];if(Je.isDynamic(b)){typeof b=="function"&&(b=h[_]=Je.unbox(b));var L=Qe(b,null);l=l||L.thisDep,i=i||L.propDep,m=m||L.contextDep}else{switch(v(s,".",_,"="),typeof b){case"number":v(b);break;case"string":v('"',b,'"');break;case"object":Array.isArray(b)&&v("[",b.join(),"]");break;default:v(a.link(b));break}v(";")}});function o(_,b){d.forEach(function(L){var B=h[L];if(!!Je.isDynamic(B)){var H=_.invoke(b,B);b(s,".",L,"=",H,";")}})}r.dynamic[c]=new Je.DynamicVariable(Qt,{thisDep:l,contextDep:m,propDep:i,ref:s,append:o}),delete r.static[c]}function ye(a,r,c,h,v){var d=le();d.stats=d.link(v),Object.keys(r.static).forEach(function(m){ee(d,r,m)}),Zu.forEach(function(m){ee(d,a,m)});var l=Pe(a,r,c,h,d);return Ge(d,l),T(d,l),f(d,l),ae(d.compile(),{destroy:function(){l.shader.program.destroy()}})}return{next:W,current:Q,procs:function(){var a=le(),r=a.proc("poll"),c=a.proc("refresh"),h=a.block();r(h),c(h);var v=a.shared,d=v.gl,l=v.next,m=v.current;h(m,".dirty=false;"),Ue(a,r),Ue(a,c,null,!0);var i;M&&(i=a.link(M)),u.oes_vertex_array_object&&c(a.link(u.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var s=0;s<x.maxAttributes;++s){var o=c.def(v.attributes,"[",s,"]"),_=a.cond(o,".buffer");_.then(d,".enableVertexAttribArray(",s,");",d,".bindBuffer(",at,",",o,".buffer.buffer);",d,".vertexAttribPointer(",s,",",o,".size,",o,".type,",o,".normalized,",o,".stride,",o,".offset);").else(d,".disableVertexAttribArray(",s,");",d,".vertexAttrib4f(",s,",",o,".x,",o,".y,",o,".z,",o,".w);",o,".buffer=null;"),c(_),M&&c(i,".vertexAttribDivisorANGLE(",s,",",o,".divisor);")}return c(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"),Object.keys(O).forEach(function(b){var L=O[b],B=h.def(l,".",b),H=a.block();H("if(",B,"){",d,".enable(",L,")}else{",d,".disable(",L,")}",m,".",b,"=",B,";"),c(H),r("if(",B,"!==",m,".",b,"){",H,"}")}),Object.keys(R).forEach(function(b){var L=R[b],B=Q[b],H,ce,ie=a.block();if(ie(d,".",L,"("),Re(B)){var J=B.length;H=a.global.def(l,".",b),ce=a.global.def(m,".",b),ie(er(J,function(F){return H+"["+F+"]"}),");",er(J,function(F){return ce+"["+F+"]="+H+"["+F+"];"}).join("")),r("if(",er(J,function(F){return H+"["+F+"]!=="+ce+"["+F+"]"}).join("||"),"){",ie,"}")}else H=h.def(l,".",b),ce=h.def(m,".",b),ie(H,");",m,".",b,"=",H,";"),r("if(",H,"!==",ce,"){",ie,"}");c(ie)}),a.compile()}(),compile:ye}}function bc(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var _c=34918,yc=34919,Ao=35007,Ec=function(e,t){if(!t.ext_disjoint_timer_query)return null;var u=[];function x(){return u.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function C(M){u.push(M)}var E=[];function S(M){var Z=x();t.ext_disjoint_timer_query.beginQueryEXT(Ao,Z),E.push(Z),P(E.length-1,E.length,M)}function D(){t.ext_disjoint_timer_query.endQueryEXT(Ao)}function N(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var U=[];function V(){return U.pop()||new N}function j(M){U.push(M)}var z=[];function P(M,Z,G){var Q=V();Q.startQueryIndex=M,Q.endQueryIndex=Z,Q.sum=0,Q.stats=G,z.push(Q)}var k=[],p=[];function g(){var M,Z,G=E.length;if(G!==0){p.length=Math.max(p.length,G+1),k.length=Math.max(k.length,G+1),k[0]=0,p[0]=0;var Q=0;for(M=0,Z=0;Z<E.length;++Z){var W=E[Z];t.ext_disjoint_timer_query.getQueryObjectEXT(W,yc)?(Q+=t.ext_disjoint_timer_query.getQueryObjectEXT(W,_c),C(W)):E[M++]=W,k[Z+1]=Q,p[Z+1]=M}for(E.length=M,M=0,Z=0;Z<z.length;++Z){var oe=z[Z],O=oe.startQueryIndex,R=oe.endQueryIndex;oe.sum+=k[R]-k[O];var re=p[O],$=p[R];$===re?(oe.stats.gpuTime+=oe.sum/1e6,j(oe)):(oe.startQueryIndex=re,oe.endQueryIndex=$,z[M++]=oe)}z.length=M}}return{beginQuery:S,endQuery:D,pushScopeStats:P,update:g,getNumPendingQueries:function(){return E.length},clear:function(){u.push.apply(u,E);for(var M=0;M<u.length;M++)t.ext_disjoint_timer_query.deleteQueryEXT(u[M]);E.length=0,u.length=0},restore:function(){E.length=0,u.length=0}}},Ac=16384,xc=256,Tc=1024,gc=34962,xo="webglcontextlost",To="webglcontextrestored",go=1,Sc=2,wc=3;function So(e,t){for(var u=0;u<e.length;++u)if(e[u]===t)return u;return-1}function Lc(e){var t=Sf(e);if(!t)return null;var u=t.gl,x=u.getContextAttributes(),C=u.isContextLost(),E=wf(u,t);if(!E)return null;var S=Ef(),D=bc(),N=E.extensions,U=Ec(u,N),V=Fa(),j=u.drawingBufferWidth,z=u.drawingBufferHeight,P={tick:0,time:0,viewportWidth:j,viewportHeight:z,framebufferWidth:j,framebufferHeight:z,drawingBufferWidth:j,drawingBufferHeight:z,pixelRatio:t.pixelRatio},k={},p={elements:null,primitive:4,count:-1,offset:0,instances:-1},g=ms(u,N),M=Cs(u,D,t,Q),Z=js(u,N,M,D),G=ju(u,N,g,D,M,Z,p);function Q(fe){return G.destroyBuffer(fe)}var W=$u(u,S,D,t),oe=_u(u,N,g,function(){re.procs.poll()},P,D,t),O=yu(u,N,g,D,t),R=ku(u,N,g,oe,O,D),re=vc(u,S,N,g,M,Z,oe,R,k,G,W,p,P,U,t),$=Wu(u,R,re.procs.poll,P,x,N,g),I=re.next,X=u.canvas,Y=[],me=[],le=[],q=[t.onDestroy],K=null;function se(){if(Y.length===0){U&&U.update(),K=null;return}K=mn.next(se),$e();for(var fe=Y.length-1;fe>=0;--fe){var Ae=Y[fe];Ae&&Ae(P,null,0)}u.flush(),U&&U.update()}function he(){!K&&Y.length>0&&(K=mn.next(se))}function Ee(){K&&(mn.cancel(se),K=null)}function Ce(fe){fe.preventDefault(),C=!0,Ee(),me.forEach(function(Ae){Ae()})}function Be(fe){u.getError(),C=!1,E.restore(),W.restore(),M.restore(),oe.restore(),O.restore(),R.restore(),G.restore(),U&&U.restore(),re.procs.refresh(),he(),le.forEach(function(Ae){Ae()})}X&&(X.addEventListener(xo,Ce,!1),X.addEventListener(To,Be,!1));function xe(){Y.length=0,Ee(),X&&(X.removeEventListener(xo,Ce),X.removeEventListener(To,Be)),W.clear(),R.clear(),O.clear(),G.clear(),oe.clear(),Z.clear(),M.clear(),U&&U.clear(),q.forEach(function(fe){fe()})}function Me(fe){n(!!fe,"invalid args to regl({...})"),n.type(fe,"object","invalid args to regl({...})");function Ae(v){var d=ae({},v);delete d.uniforms,delete d.attributes,delete d.context,delete d.vao,"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);function l(m){if(m in d){var i=d[m];delete d[m],Object.keys(i).forEach(function(s){d[m+"."+s]=i[s]})}}return l("blend"),l("depth"),l("cull"),l("stencil"),l("polygonOffset"),l("scissor"),l("sample"),"vao"in v&&(d.vao=v.vao),d}function ge(v,d){var l={},m={};return Object.keys(v).forEach(function(i){var s=v[i];if(Je.isDynamic(s)){m[i]=Je.unbox(s,i);return}else if(d&&Array.isArray(s)){for(var o=0;o<s.length;++o)if(Je.isDynamic(s[o])){m[i]=Je.unbox(s,i);return}}l[i]=s}),{dynamic:m,static:l}}var Ge=ge(fe.context||{},!0),dr=ge(fe.uniforms||{},!0),Mr=ge(fe.attributes||{},!1),f=ge(Ae(fe),!1),T={gpuTime:0,cpuTime:0,count:0},y=re.compile(f,Mr,dr,Ge,T),ee=y.draw,ye=y.batch,a=y.scope,r=[];function c(v){for(;r.length<v;)r.push(null);return r}function h(v,d){var l;if(C&&n.raise("context lost"),typeof v=="function")return a.call(this,null,v,0);if(typeof d=="function")if(typeof v=="number")for(l=0;l<v;++l)a.call(this,null,d,l);else if(Array.isArray(v))for(l=0;l<v.length;++l)a.call(this,v[l],d,l);else return a.call(this,v,d,0);else if(typeof v=="number"){if(v>0)return ye.call(this,c(v|0),v|0)}else if(Array.isArray(v)){if(v.length)return ye.call(this,v,v.length)}else return ee.call(this,v)}return ae(h,{stats:T,destroy:function(){y.destroy()}})}var Le=R.setFBO=Me({framebuffer:Je.define.call(null,go,"framebuffer")});function Pe(fe,Ae){var ge=0;re.procs.poll();var Ge=Ae.color;Ge&&(u.clearColor(+Ge[0]||0,+Ge[1]||0,+Ge[2]||0,+Ge[3]||0),ge|=Ac),"depth"in Ae&&(u.clearDepth(+Ae.depth),ge|=xc),"stencil"in Ae&&(u.clearStencil(Ae.stencil|0),ge|=Tc),n(!!ge,"called regl.clear with no buffer specified"),u.clear(ge)}function ke(fe){if(n(typeof fe=="object"&&fe,"regl.clear() takes an object as input"),"framebuffer"in fe)if(fe.framebuffer&&fe.framebuffer_reglType==="framebufferCube")for(var Ae=0;Ae<6;++Ae)Le(ae({framebuffer:fe.framebuffer.faces[Ae]},fe),Pe);else Le(fe,Pe);else Pe(null,fe)}function Ue(fe){n.type(fe,"function","regl.frame() callback must be a function"),Y.push(fe);function Ae(){var ge=So(Y,fe);n(ge>=0,"cannot cancel a frame twice");function Ge(){var dr=So(Y,Ge);Y[dr]=Y[Y.length-1],Y.length-=1,Y.length<=0&&Ee()}Y[ge]=Ge}return he(),{cancel:Ae}}function He(){var fe=I.viewport,Ae=I.scissor_box;fe[0]=fe[1]=Ae[0]=Ae[1]=0,P.viewportWidth=P.framebufferWidth=P.drawingBufferWidth=fe[2]=Ae[2]=u.drawingBufferWidth,P.viewportHeight=P.framebufferHeight=P.drawingBufferHeight=fe[3]=Ae[3]=u.drawingBufferHeight}function $e(){P.tick+=1,P.time=be(),He(),re.procs.poll()}function Fe(){oe.refresh(),He(),re.procs.refresh(),U&&U.update()}function be(){return(Fa()-V)/1e3}Fe();function Xe(fe,Ae){n.type(Ae,"function","listener callback must be a function");var ge;switch(fe){case"frame":return Ue(Ae);case"lost":ge=me;break;case"restore":ge=le;break;case"destroy":ge=q;break;default:n.raise("invalid event, must be one of frame,lost,restore,destroy")}return ge.push(Ae),{cancel:function(){for(var Ge=0;Ge<ge.length;++Ge)if(ge[Ge]===Ae){ge[Ge]=ge[ge.length-1],ge.pop();return}}}}var Se=ae(Me,{clear:ke,prop:Je.define.bind(null,go),context:Je.define.bind(null,Sc),this:Je.define.bind(null,wc),draw:Me({}),buffer:function(fe){return M.create(fe,gc,!1,!1)},elements:function(fe){return Z.create(fe,!1)},texture:oe.create2D,cube:oe.createCube,renderbuffer:O.create,framebuffer:R.create,framebufferCube:R.createCube,vao:G.createVAO,attributes:x,frame:Ue,on:Xe,limits:g,hasExtension:function(fe){return g.extensions.indexOf(fe.toLowerCase())>=0},read:$,destroy:xe,_gl:u,_refresh:Fe,poll:function(){$e(),U&&U.update()},now:be,stats:D});return t.onDone(null,Se),Se}return Lc})})(ca);var Ro=ca.exports,la=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var A=0,_e=arguments.length;_e--;)A+=arguments[_e]*arguments[_e];return Math.sqrt(A)});function da(){var A=new la(16);return la!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=0,A[12]=0,A[13]=0,A[14]=0),A[0]=1,A[5]=1,A[10]=1,A[15]=1,A}function ma(A,_e,de,ae,pe,Te,Ve){var ve=1/(_e-de),Oe=1/(ae-pe),_r=1/(Te-Ve);return A[0]=-2*ve,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*Oe,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*_r,A[11]=0,A[12]=(_e+de)*ve,A[13]=(pe+ae)*Oe,A[14]=(Ve+Te)*_r,A[15]=1,A}const Lt={positions:[[0,-.5],[1,-.5],[1,.5],[0,.5]],cells:[[0,1,2],[0,2,3]]};function Co(A){return A({vert:`
        precision highp float;
        attribute vec2 position;
        attribute vec2 pA, pB, pC, pD;
        uniform float width;
        uniform mat4 projection;
  
        void main() {
          // Select the three points we'll use and adjust the vertex according to 
          // the side of the segment the vertex is on and the order of the points.
          vec2 p0 = pA;
          vec2 p1 = pB;
          vec2 p2 = pC;
          vec2 pos = position;
          if (position.x == 1.0) {
            p0 = pD;
            p1 = pC;
            p2 = pB;
            pos = vec2(1.0 - position.x, -position.y);
          }
  
          // Find the normal vector.
          vec2 tangent = normalize(normalize(p2 - p1) + normalize(p1 - p0));
          vec2 normal = vec2(-tangent.y, tangent.x);
  
          // Find the perpendicular vectors.
          vec2 p01 = p1 - p0;
          vec2 p21 = p1 - p2;
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));
  
          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          
          // If this is the intersecting vertex, 
          if (sign(pos.y) == -sigma) {
            vec2 point = 0.5 * normal * -sigma * width / dot(normal, p01Norm);
            gl_Position = projection * vec4(p1 + point, 0, 1);
          } else {
            vec2 xBasis = p2 - p1;
            vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
            vec2 point = p1 + xBasis * pos.x + yBasis * width * pos.y;
            gl_Position = projection * vec4(point, 0, 1);
          }
        }`,frag:`
        precision highp float;
        uniform vec4 color;
        void main() {
          gl_FragColor = color;
        }`,attributes:{position:{buffer:A.buffer(Lt.positions),divisor:0},pA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0},pB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2},pC:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*4},pD:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*6}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},depth:{enable:!1},elements:A.elements(Lt.cells),instances:A.prop("segments"),viewport:A.prop("viewport")})}function Oo(A){return A({vert:`
        precision highp float;
        attribute vec2 position;
        attribute vec2 pA, pB, pC;
        uniform float width;
        uniform mat4 projection;
  
        void main() {
  
          if (position.x == 0.0) {
            vec2 xBasis = pB - pA;
            vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
            vec2 point = pA + xBasis * position.x + yBasis * width * position.y;
            gl_Position = projection * vec4(point, 0, 1);
            return;
          }

          // Find the normal vector.
          vec2 tangent = normalize(normalize(pC - pB) + normalize(pB - pA));
          vec2 normal = vec2(-tangent.y, tangent.x);
  
          // Find the perpendicular vectors.
          vec2 ab = pB - pA;
          vec2 cb = pB - pC;
          vec2 abNorm = normalize(vec2(-ab.y, ab.x));
  
          // Determine the bend direction.
          float sigma = sign(dot(ab + cb, normal));
          
          if (sign(position.y) == -sigma) {
            vec2 position = 0.5 * normal * -sigma * width / dot(normal, abNorm);
            gl_Position = projection * vec4(pB + position, 0, 1);
          } else {
            vec2 xBasis = pB - pA;
            vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
            vec2 point = pA + xBasis * position.x + yBasis * width * position.y;
            gl_Position = projection * vec4(point, 0, 1);
          }
        }`,frag:`
        precision highp float;
        uniform vec4 color;
        void main() {
          gl_FragColor = color;
        }`,attributes:{position:{buffer:A.buffer(Lt.positions),divisor:0},pA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0,stride:Float32Array.BYTES_PER_ELEMENT*6},pB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2,stride:Float32Array.BYTES_PER_ELEMENT*6},pC:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*4,stride:Float32Array.BYTES_PER_ELEMENT*6}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},depth:{enable:!1},elements:A.elements(Lt.cells),instances:A.prop("segments"),viewport:A.prop("viewport")})}const ha={positions:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],cells:[[0,1,2],[0,2,3]]};function Bo(A){return A({vert:`
      precision highp float;
      attribute vec2 pointA, pointB, pointC;
      attribute vec4 position;
      uniform float width;
      uniform mat4 projection;
  
      void main() {
        // Find the miter vector.
        vec2 tangent = normalize(normalize(pointC - pointB) + normalize(pointB - pointA));
        vec2 miter = vec2(-tangent.y, tangent.x);

        // Find the perpendicular vectors.
        vec2 ab = pointB - pointA;
        vec2 cb = pointB - pointC;
        vec2 abNorm = normalize(vec2(-ab.y, ab.x));
        vec2 cbNorm = -normalize(vec2(-cb.y, cb.x));

        // Determine the bend direction.
        float sigma = sign(dot(ab + cb, miter));

        // Calculate the basis vectors for the miter geometry.
        vec2 p0 = 0.5 * width * sigma * (sigma < 0.0 ? abNorm : cbNorm);
        vec2 p1 = 0.5 * miter * sigma * width / dot(miter, abNorm);
        vec2 p2 = 0.5 * width * sigma * (sigma < 0.0 ? cbNorm : abNorm);
        vec2 p3 = -0.5 * miter * sigma * width / dot(miter, abNorm);

        // Calculate the final point position.
        vec2 point = pointB + position.x * p0 + position.y * p1 + position.z * p2 + position.w * p3;
        gl_Position = projection * vec4(point, 0, 1);
      }`,frag:`
      precision highp float;
      uniform vec4 color;
      void main() {
        gl_FragColor = color;
      }`,depth:{enable:!1},attributes:{position:{buffer:A.buffer(ha.positions),divisor:0},pointA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0},pointB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2},pointC:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*4}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},elements:A.elements(ha.cells),instances:A.prop("instances"),viewport:A.prop("viewport")})}const pa=[[1,0,0],[0,1,0],[0,0,1]];function Fo(A){return A({vert:`
    precision highp float;
    attribute vec2 pointA, pointB, pointC;
    attribute vec3 position;
    uniform float width;
    uniform mat4 projection;

    void main() {
      vec2 tangent = normalize(normalize(pointC - pointB) + normalize(pointB - pointA));
      vec2 normal = vec2(-tangent.y, tangent.x);
      vec2 ab = pointB - pointA;
      vec2 cb = pointB - pointC;
      float sigma = sign(dot(ab + cb, normal));
      vec2 abn = normalize(vec2(-ab.y, ab.x));
      vec2 cbn = -normalize(vec2(-cb.y, cb.x));
      vec2 p0 = 0.5 * sigma * width * (sigma < 0.0 ? abn : cbn);
      vec2 p1 = 0.5 * sigma * width * (sigma < 0.0 ? cbn : abn);
      vec2 p2 = -0.5 * normal * sigma * width / dot(normal, abn);
      vec2 point = pointB + position.x * p0 + position.y * p1 + position.z * p2;
      gl_Position = projection * vec4(point, 0, 1);
    }`,frag:`
    precision highp float;
    uniform vec4 color;
    void main() {
      gl_FragColor = color;
    }`,depth:{enable:!1},attributes:{position:{buffer:A.buffer(pa),divisor:0},pointA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0},pointB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2},pointC:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*4}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},count:pa.length,instances:A.prop("instances"),viewport:A.prop("viewport")})}function Go(A){const _e=[],de=[];for(let ae=0;ae<A+2;ae++)_e.push(ae);for(let ae=0;ae<A;ae++)de.push([0,ae+1,ae+2]);return{ids:_e,cells:de}}function No(A,_e){const de=Go(_e);return A({vert:`
    precision highp float;
    attribute vec2 pointA, pointB, pointC;
    attribute float id;
    uniform float width;
    uniform mat4 projection;

    const float resolution = ${_e.toExponential()};

    void main() {
      // Calculate the x- and y- basis vectors.
      vec2 xBasis = normalize(normalize(pointC - pointB) + normalize(pointB - pointA));
      vec2 yBasis = vec2(-xBasis.y, xBasis.x);

      // Calculate the normal vectors for each neighboring segment.
      vec2 ab = pointB - pointA;
      vec2 cb = pointB - pointC;
      vec2 abn = normalize(vec2(-ab.y, ab.x));
      vec2 cbn = -normalize(vec2(-cb.y, cb.x));

      // Determine the direction of the bend.
      float sigma = sign(dot(ab + cb, yBasis));

      // If this is the zeroth id, it's the center of our circle. Stretch it to meet the segments' intersection.
      if (id == 0.0) {
        gl_Position = projection * vec4(pointB + -0.5 * yBasis * sigma * width / dot(yBasis, abn), 0, 1);
        return;
      }

      // Otherwise find the angle for this vertex.
      float theta = acos(dot(abn, cbn));
      theta = (sigma * 0.5 * ${Math.PI}) + -0.5 * theta + theta * (id - 1.0) / resolution;

      // Find the vertex position from the angle and multiply it by our basis vectors.
      vec2 pos = 0.5 * width * vec2(cos(theta), sin(theta));
      pos = pointB + xBasis * pos.x + yBasis * pos.y;

      gl_Position = projection * vec4(pos, 0, 1);
    }`,frag:`
    precision highp float;
    uniform vec4 color;
    void main() {
      gl_FragColor = color;
    }`,depth:{enable:!1},attributes:{id:{buffer:A.buffer(de.ids),divisor:0},pointA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0},pointB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2},pointC:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*4}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},elements:A.elements(de.cells),instances:A.prop("instances"),viewport:A.prop("viewport")})}function Do(A){const _e=[[0,0]];for(let ae=0;ae<=A;ae++){const pe=-.5*Math.PI+Math.PI*ae/A;_e.push([.5*Math.cos(pe),.5*Math.sin(pe)])}const de=[];for(let ae=0;ae<A;ae++)de.push([0,ae+1,ae+2]);return{positions:_e,cells:de}}function Po(){return{positions:[[0,.5],[0,-.5],[.5,-.5],[.5,.5]],cells:[[0,1,2],[0,2,3]]}}function va(A,_e){return A({vert:`
        precision highp float;
        attribute vec2 position;
        attribute vec2 pA, pB;
        uniform float width;
        uniform mat4 projection;
  
        void main() {
          vec2 xBasis = normalize(pA - pB);
          vec2 yBasis = vec2(-xBasis.y, xBasis.x);
          vec2 point = pA + xBasis * width * position.x + yBasis * width * position.y;
          gl_Position = projection * vec4(point, 0, 1);
        }`,frag:`
        precision highp float;
        uniform vec4 color;
        void main() {
          gl_FragColor = color;
        }`,attributes:{position:{buffer:A.buffer(_e.positions),divisor:0},pA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0,stride:Float32Array.BYTES_PER_ELEMENT*4},pB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2,stride:Float32Array.BYTES_PER_ELEMENT*4}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},depth:{enable:!1},elements:A.elements(_e.cells),instances:A.prop("instances"),viewport:A.prop("viewport")})}function Io(A,_e){const de=A/9,ae=_e/10,pe=[];for(let Te=1;Te<9;Te+=2)pe.push([(Te+0)*de-A/2,3*ae-_e/2]),pe.push([(Te+1)*de-A/2,7*ae-_e/2]);return pe}function Mo(A){const _e=Fo(A),de=Bo(A),ae=No(A,16),pe=va(A,Do(16)),Te=va(A,Po()),Ve=Co(A),ve=Oo(A),Oe=A.buffer(0);function _r(We,hr,ot,Vr,Hr,qe){const ur=Io(We.width,We.height),or=ma(da(),-We.width/2,We.width/2,-We.height/2,We.height/2,0,-1),yr={x:0,y:0,width:We.width,height:We.height},Rt=.45*Math.sin(performance.now()*.002)+.75,Ct=Math.sin(performance.now()*3e-4),Ie=[];for(const Ot of ur)Ie.push([Ot[0]*Rt,Ot[1]*Ct]);A.clear({color:[0,0,0,0]}),Ve({points:Oe(Ie),segments:ur.length-3,width:We.width*.05,color:hr?[1,0,0,qe]:[.25,.25,.25,qe],projection:or,viewport:yr}),Hr&&ve({points:Oe([Ie[0],Ie[1],Ie[2],Ie[ur.length-1],Ie[ur.length-2],Ie[ur.length-3]]),segments:2,width:We.width*.05,color:hr?[0,.5,0,qe]:[.25,.25,.25,qe],projection:or,viewport:yr});const ft={miter:de,bevel:_e,round:ae,none:void 0}[ot];ft&&ft({points:Oe(Ie),instances:ur.length-2,width:We.width*.05,color:hr?[0,0,1,qe]:[.25,.25,.25,qe],projection:or,viewport:yr});const zr={round:pe,square:Te,none:void 0}[Vr];zr&&zr({points:Oe([Ie[0],Ie[1],Ie[ur.length-1],Ie[ur.length-2]]),instances:2,width:We.width*.05,color:hr?[1,0,1,qe]:[.25,.25,.25,qe],projection:or,viewport:yr})}return _r}const ba=[[0,-.5],[1,-.5],[1,.5],[0,-.5],[1,.5],[0,.5]];function ko(A){return A({vert:`
      precision highp float;
      attribute vec2 position;
      attribute vec2 pointA, pointB;
      uniform float width;
      uniform mat4 projection;
  
      void main() {
        vec2 xBasis = pointB - pointA;
        vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
        vec2 point = pointA + xBasis * position.x + yBasis * width * position.y;
        gl_Position = projection * vec4(point, 0, 1);
      }`,frag:`
      precision highp float;
      uniform vec4 color;
      void main() {
        gl_FragColor = color;
      }`,attributes:{position:{buffer:A.buffer(ba),divisor:0},pointA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0},pointB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},cull:{enable:!0,face:"back"},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},count:ba.length,instances:A.prop("segments"),viewport:A.prop("viewport")})}function Uo(A,_e){const de=[[0,-.5,0],[0,-.5,1],[0,.5,1],[0,-.5,0],[0,.5,1],[0,.5,0]];for(let ae=0;ae<_e;ae++){const pe=Math.PI/2+(ae+0)*Math.PI/_e,Te=Math.PI/2+(ae+1)*Math.PI/_e;de.push([0,0,0]),de.push([.5*Math.cos(pe),.5*Math.sin(pe),0]),de.push([.5*Math.cos(Te),.5*Math.sin(Te),0])}for(let ae=0;ae<_e;ae++){const pe=3*Math.PI/2+(ae+0)*Math.PI/_e,Te=3*Math.PI/2+(ae+1)*Math.PI/_e;de.push([0,0,1]),de.push([.5*Math.cos(pe),.5*Math.sin(pe),1]),de.push([.5*Math.cos(Te),.5*Math.sin(Te),1])}return{buffer:A.buffer(de),count:de.length}}function jo(A,_e){const de=Uo(A,_e);return A({vert:`
      precision highp float;
      attribute vec3 position;
      attribute vec2 pointA, pointB;
      uniform float width;
      uniform mat4 projection;
  
      void main() {
        vec2 xBasis = normalize(pointB - pointA);
        vec2 yBasis = vec2(-xBasis.y, xBasis.x);
        vec2 offsetA = pointA + width * (position.x * xBasis + position.y * yBasis);
        vec2 offsetB = pointB + width * (position.x * xBasis + position.y * yBasis);
        vec2 point = mix(offsetA, offsetB, position.z);
        gl_Position = projection * vec4(point, 0, 1);
      }`,frag:`
      precision highp float;
      uniform vec4 color;
      void main() {
        gl_FragColor = color;
      }`,attributes:{position:{buffer:de.buffer,divisor:0},pointA:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*0},pointB:{buffer:A.prop("points"),divisor:1,offset:Float32Array.BYTES_PER_ELEMENT*2}},uniforms:{width:A.prop("width"),color:A.prop("color"),projection:A.prop("projection")},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}},cull:{enable:!0,face:"back"},count:de.count,instances:A.prop("segments"),viewport:A.prop("viewport")})}function Vo(A,_e){const de=A/9,ae=_e/10,pe=[];for(let Te=1;Te<9;Te+=2)pe.push([(Te+0)*de-A/2,3*ae-_e/2]),pe.push([(Te+1)*de-A/2,7*ae-_e/2]);return pe}function Ho(A){const _e=ko(A),de=jo(A,16),ae=A.buffer(0);function pe(Te,Ve,ve){const Oe=Vo(Te.width,Te.height),_r=ma(da(),-Te.width/2,Te.width/2,-Te.height/2,Te.height/2,0,-1),We={x:0,y:0,width:Te.width,height:Te.height},hr=.45*Math.sin(performance.now()*.002)+.75,ot=Math.sin(performance.now()*3e-4),Vr=[];for(const qe of Oe)Vr.push([qe[0]*hr,qe[1]*ot]);A.clear({color:[0,0,0,0]}),(Ve?_e:de)({points:ae(Vr),segments:Oe.length-1,width:Te.width*.05,color:[.25,.25,.25,ve],projection:_r,viewport:We})}return pe}function _a(A){const _e=A.getBoundingClientRect();return _e.bottom>=0&&_e.top<=(window.innerHeight||document.documentElement.clientHeight)}const ir=document.createElement("canvas"),ya=Ro({canvas:ir,extensions:["ANGLE_instanced_arrays"]}),zo=Mo(ya);window.newStrip=function(A,_e,de,ae,pe,Te){function Ve(){requestAnimationFrame(Ve);const ve=document.getElementById(A);if(!_a(ve))return;(ve.width!==ve.clientWidth||ve.height!==ve.clientHeight)&&(ve.width=ve.clientWidth,ve.height=ve.clientHeight),(ir.width!==ve.clientWidth||ir.height!==ve.clientHeight)&&(ir.width=ve.clientWidth,ir.height=ve.clientHeight),zo(ve,_e,de,ae,pe,Te);const Oe=ve.getContext("2d");Oe==null||Oe.clearRect(0,0,ve.width,ve.height),Oe==null||Oe.drawImage(ir,0,0)}requestAnimationFrame(Ve)};const $o=Ho(ya);window.oldStrip=function(A,_e,de){function ae(){requestAnimationFrame(ae);const pe=document.getElementById(A);if(!_a(pe))return;(pe.width!==pe.clientWidth||pe.height!==pe.clientHeight)&&(pe.width=pe.clientWidth,pe.height=pe.clientHeight),(ir.width!==pe.clientWidth||ir.height!==pe.clientHeight)&&(ir.width=pe.clientWidth,ir.height=pe.clientHeight),$o(pe,_e,de);const Te=pe.getContext("2d");Te==null||Te.clearRect(0,0,pe.width,pe.height),Te==null||Te.drawImage(ir,0,0)}requestAnimationFrame(ae)}});
